"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3546],{98066:function(e,t,n){n.d(t,{B8:function(){return M}});var s=n(27573),o=n(4974),r=n(56364),a=n(64914),i=n(15489),l=n(7653),c=n(59679),u=n(70318),d=n(11096),p=n(44846),h=n(70452),m=n(89987),g=n(26921),f=n(57908),x=n(62124),b=n(3095),y=n(62071);let v=e=>{let{isStreaming:t,children:n,...o}=e;return t?n:(0,s.jsx)(C,{...o,children:n})},C=e=>{let{children:t,sendMessage:n,contentType:o="text"}=e,{value:r}=(0,p.F)("art_last_letter"),a=r&&void 0!==n,[i,c]=(0,l.useState)([]),[u,v]=(0,l.useState)({top:0,left:0,width:0}),[C,w]=(0,l.useState)(!1),[R,z]=(0,l.useState)(!1),[E,S]=(0,l.useState)(""),[j,q]=(0,l.useState)(""),[M,T]=(0,l.useState)(!1),N=(0,l.useRef)(null),k=(0,l.useRef)(null),P=(0,l.useCallback)(e=>{var t;let n=function(e){let t=[];for(let n=0;n<e.rangeCount;n++){let s=e.getRangeAt(n);if(s.startContainer===s.endContainer&&s.startContainer.nodeType===Node.TEXT_NODE){let e=s.startContainer,n=document.createRange();for(let o=s.startOffset;o<s.endOffset;o++){n.setStart(e,o),n.setEnd(e,o+1);let s=Array.from(n.getClientRects());t.push(...s)}n.detach()}else{let e=function(e){let t;let n=[],s=document.createTreeWalker(e.commonAncestorContainer,NodeFilter.SHOW_TEXT,t=>e.intersectsNode(t)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT);for(;t=s.nextNode();)n.push(t);return n}(s);e.forEach((n,o)=>{let r=document.createRange(),a="length"in n?n.length:0,i=0===o,l=o===e.length-1,c=i?s.startOffset:0,u=l?s.endOffset:a;r.setStart(n,c),r.setEnd(n,u);let d=Array.from(r.getClientRects());t.push(...d),r.detach()})}}return t}(e),s=null===(t=N.current)||void 0===t?void 0:t.getBoundingClientRect();return Array.from(n).map(e=>({top:e.top-((null==s?void 0:s.top)||0)-2.5,left:e.left-((null==s?void 0:s.left)||0),width:e.width,height:e.height+5.5}))},[]),F=(0,l.useCallback)(e=>{var t;let n=e.getRangeAt(0);return null===(t=N.current)||void 0===t?void 0:t.contains(n.commonAncestorContainer)},[]);(0,l.useEffect)(()=>{let e=()=>{T(!0)},t=e=>{"Escape"===e.key&&(z(!1),w(!1),S(""),c([]))},n=e=>{if(k.current&&k.current.contains(e.target))return;let t=window.getSelection();if(t&&!t.isCollapsed&&F(t)){var n,s,o,r;let e,a;let i=P(t);if(c(i),i.every((e,t,n)=>0===t||5>Math.abs(e.top-n[0].top))){let t=Math.max(...i.map(e=>e.left+e.width));e=i[0].top-9,a=t+10}else{let t=Math.max(...i.map(e=>e.top+e.height));a=Math.min(...i.map(e=>e.left)),e=Math.min((null!==(o=null===(s=N.current)||void 0===s?void 0:s.scrollHeight)&&void 0!==o?o:0)-50,t)}let l=((null!==(r=null===(n=N.current)||void 0===n?void 0:n.scrollWidth)&&void 0!==r?r:1e3)-a)/3*2;v({top:e,left:a,width:l}),w(!0),z(!1),q(t.toString())}else c([]),w(!1),z(!1),q(""),S("");T(!1)};return a&&(document.addEventListener("mousedown",e),document.addEventListener("mouseup",n),document.addEventListener("keydown",t)),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("mouseup",n),document.removeEventListener("keydown",t)}},[P,F,a]);let I=e=>{a&&(n(e),S(""),z(!1),w(!1),c([]))},L=()=>"text"===o?j.split("\n").map(e=>"> ".concat(e)).join("\n"):"code"===o?"```\n".concat(j,"\n```"):void 0,_=()=>{I({prompt:"".concat(L(),"\n\n").concat(E),attachments:[],files:[],syncSources:[]})};return(0,s.jsxs)("div",{ref:N,className:(0,f.W)("w-full h-full relative",a?M?"text"===o?"[&_:not(input)::selection]:bg-accent-main-000/20":"[&_:not(input)::selection]:bg-[rgba(240,238,229,0.3)]":"[&_*::selection]:bg-transparent":"","text"===o?"[&_:not(input)::selection]:text-text-200":"[&_:not(input)::selection]:text-[inherit]"),children:[t,i.map((e,t)=>(0,s.jsx)("div",{className:(0,f.W)("absolute pointer-events-none","text"===o?"bg-accent-main-000/20":"bg-[rgba(240,238,229,0.3)]"),style:{top:e.top,left:e.left,width:e.width,height:e.height}},t)),(0,s.jsx)(x.M,{children:C&&!R&&(0,s.jsx)(b.E.div,{className:(0,f.W)("absolute z-20"),initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",damping:30,stiffness:400,delay:.2},style:{top:u.top+5,left:u.left},children:(0,s.jsx)("div",{className:(0,f.W)("border-0.5 flex items-center rounded-lg px-2 pb-1 pt-3 shadow transition","text"===o?"bg-bg-000 text-text-400 border-border-300":"bg-[rgba(61,67,79,1)] text-white/90 border-white/10"),children:(0,s.jsxs)("div",{className:"-mx-1 -mt-2 flex items-stretch justify-between gap-0.5",children:[(0,s.jsxs)(y.Z,{onClick:()=>{z(!0)},isAssistant:!0,className:"text"===o?"":"hover:!bg-[rgba(75,81,93,1)] ",children:[(0,s.jsx)(h.A,{size:16}),"Improve"]}),(0,s.jsxs)(y.Z,{onClick:()=>{I({prompt:"Can you explain this section to me in more detail?\n\n".concat(L()),attachments:[],files:[],syncSources:[]})},isAssistant:!0,className:"text"===o?"":"hover:!bg-[rgba(75,81,93,1)]",children:[(0,s.jsx)(m.v,{size:16}),"Explain"]})]})})})}),(0,s.jsx)(x.M,{children:R&&(0,s.jsxs)(b.E.form,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{type:"spring",damping:30,stiffness:400},className:(0,f.W)("z-20 absolute flex gap-2 p-2 pl-4 items-center h-12 rounded-lg ","text"===o?"bg-bg-000 text-text-200 border border-0.5 border-border-300 shadow-xl":"bg-black/90 text-[rgba(206,204,197,1)] border border-0.5 border-white/30 shadow-xl"),style:{top:u.top+5,left:u.left,width:u.width},ref:k,onSubmit:e=>{e.preventDefault(),_()},children:[(0,s.jsx)("input",{type:"text",value:E,onChange:e=>S(e.target.value),placeholder:"Describe what you would like to update...",className:(0,f.W)("py-0.5 px-0 border-0 bg-transparent text-sm grow outline-none focus:outline-none focus:ring-0","text"===o?"text-text-200 placeholder-text-500":"text-white/90 placeholder-white/50"),autoFocus:!0}),(0,s.jsxs)(x.M,{children:[E.trim().length>0?(0,s.jsx)(b.E.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{type:"spring",damping:30,stiffness:400,delay:0},children:(0,s.jsx)(d.Z,{size:"sm",onClick:()=>_(),"aria-label":"Send Message",type:"submit",className:"shadow-md",children:(0,s.jsxs)("div",{className:"flex items-center gap-2 select-none",children:[(0,s.jsx)("span",{children:"Update"})," ",(0,s.jsx)(g.R,{weight:"bold",size:20,className:"bg-accent-main-000 rounded-[3px] p-1 -mr-1"})]})})}):null," "]})]})})]})};var w=e=>{let{title:t,description:n,inset:o,action:r}=e;return(0,s.jsxs)("div",{className:"border-border-300 shadow-sm w-[300px] max-w-full bg-bg-000 rounded-xl p-5 border",children:[(0,s.jsx)("div",{className:"text-left mb-2 font-medium text-sm",children:t}),(0,s.jsx)("p",{className:"mb-2 text-sm",children:n}),!!o&&(0,s.jsx)("div",{className:"flex flex-col rounded-md bg-text-000 bg-opacity-5 p-4 font-mono text-xs text-text-300",children:o}),r&&(0,s.jsx)("div",{className:"flex justify-end",children:(0,s.jsx)(d.Z,{variant:"primary",className:"mt-4 text-sm",onClick:r.onClick,disabled:r.disabled,loading:r.loading,children:r.label})})]})},R=e=>{var t,n,o;let{error:r,sendMessage:a,isStreaming:i}=e,[c,u]=(0,l.useState)(!1),d=function(e){switch(e.type){case"UnsupportedImports":return{title:"Artifact failed to load",description:"The generated artifact uses libraries we don't support:",inset:[...e.unsupportedModules,...e.nonExistentIcons.map(e=>"{ ".concat(e,' } from "lucide-react"'))],subtext:"The code itself may still work. To use it, you'll need a development setup with these libraries installed."};case"RuntimeError":return{title:"Error running artifact",description:"An error occurred while trying to run the generated artifact.",inset:[e.message],insetStyle:"danger"};case"FileNotFound":return{title:"File not found",description:'The file "'.concat(e.fileName,'" could not be found.'),subtext:"Please check the file name and try again."};case"ClaudeCompletionError":return{title:"Error in Claude completion",description:e.message}}}(r.error),p="> ".concat(d.description,"\n").concat(null!==(o=null===(t=d.inset)||void 0===t?void 0:t.map(e=>"> `".concat(e,"`")).join("\n"))&&void 0!==o?o:"","\n\n\nCan you fix this error in `").concat(r.artifactId,"`?");return(0,s.jsx)("div",{className:"absolute bottom-5 left-5 right-5",children:(0,s.jsx)(w,{title:d.title,description:d.description,inset:(null===(n=d.inset)||void 0===n?void 0:n.length)?d.inset?(0,s.jsx)("ul",{children:d.inset.map((e,t)=>(0,s.jsx)("li",{children:e},t))}):null:void 0,action:a?{label:"Try fixing with Claude",onClick:()=>{u(!0),null==a||a({prompt:p,attachments:[],files:[],syncSources:[]})},disabled:i,loading:c}:void 0})})},z=n(51571),E=n(13623),S=n(61867),j=n(92829);let q=(0,l.forwardRef)((e,t)=>{let{content:n,className:o,type:r,onSandboxConfirmation:a,capabilities:i,onReportError:c,onSetContent:u,onRefresh:h}=e,{value:m}=(0,p.F)("apps_claudeai_report_artifacts_errors"),{userContentRendererUrl:g}=(0,z.m)(),[y,v]=(0,l.useState)(!1),C=(0,l.useRef)(null),{value:w}=(0,p.F)("apps_use_turmeric"),[R,q]=(0,l.useState)(0),M=e=>e>=100,T=(0,l.useCallback)(async e=>e.method===S.to.ReadyForContent?(v(!0),null==a||a(),Promise.resolve()):e.method===S.to.GetFile?i&&i.getFile?Promise.resolve({"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.GetFileResponse",value:await i.getFile(e.payload.key)}):Promise.reject():e.method===S.to.SendConversationMessage?i&&i.sendMessage?(await i.sendMessage({prompt:e.payload.message,attachments:[],files:[],syncSources:[]}),Promise.resolve()):Promise.reject():e.method===S.to.ClaudeCompletion?i&&i.claudeComplete?(q(e=>e+1),Promise.resolve({"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.ClaudeCompletionResponse",completion:await i.claudeComplete(e.payload.prompt)})):Promise.reject():e.method===S.to.ReportError?(null==c||c(e.payload.error),Promise.resolve()):Promise.reject(),[a,i,v,c,q]),N=(0,l.useCallback)(async e=>e===S.to.ClaudeCompletion&&M(R)?"denied":Promise.resolve("accepted"),[R]),{sendRequest:k,updatePermission:P}=(0,j.I)({iframeRef:C,allowedOrigin:g,onCapabilityAction:T,onPermissionRequested:N,initialPermissions:{}});(0,l.useEffect)(()=>{M(R)&&(P(S.to.ClaudeCompletion,"denied"),(0,E.uT)("Claude completion request limit hit."))},[R,P]);let F=(0,l.useCallback)(()=>{(0,E.uT)("Claude completion modal confirmed"),q(0),P(S.to.ClaudeCompletion,"accepted")},[P]);return(0,l.useEffect)(()=>{y&&n&&r&&(null==u||u(),null==k||k(S.to.SetContent,{content:n,type:r,"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.SandboxContent"}))},[n,k,r,y,u]),(0,l.useImperativeHandle)(t,()=>({refresh:()=>{null==h||h(),v(!1);let e=C.current;e&&(e.src="".concat(g).concat(m?"?errorReportingMode=parent":""))}})),(0,s.jsxs)("div",{className:(0,f.Z)("relative",o),children:[(0,s.jsx)("iframe",{ref:C,className:"h-full w-full",sandbox:"allow-scripts allow-same-origin",title:"Claude content",loading:"lazy",src:"".concat(g).concat(m?"?errorReportingMode=parent":""),allow:"fullscreen"}),(0,s.jsx)(x.M,{children:!y&&(0,s.jsx)(b.E.div,{className:"bg-bg-100 absolute inset-0 z-10",initial:{opacity:1},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15,ease:"easeInOut"}})}),w&&M(R)&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-bg-100 p-4 rounded shadow-lg",children:[(0,s.jsx)("p",{className:"text-fg-100 mb-4",children:"Many requests made. Acknowledge that you're still here to continue."}),(0,s.jsx)(d.Z,{onClick:F,variant:"primary",children:"I'm still here"})]})})]})});q.displayName="RichSandbox";let M=e=>{let{content:t,language:n,type:o,showRaw:r,richSandboxRef:c,isCurrentStreaming:u,isChatStreaming:d,onSandboxConfirmation:p,sendMessage:h,richSandboxCapabilities:m,isLatestVersion:g,artifactId:f,artifactVersion:x}=e,b=!r&&void 0!==o&&void 0!==t&&o!==i.JP.Code&&o!==i.JP.Markdown,[y,v]=(0,l.useState)(null),C=(0,l.useCallback)(e=>{void 0!==f&&void 0!==x&&v({error:e,artifactId:f,artifactVersion:x})},[f,x]),w=(0,l.useCallback)(()=>{v(e=>e&&(e.artifactId!==f||e.artifactVersion!==x)?null:e)},[f,x]),z=(0,l.useCallback)(()=>{v(null)},[]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:b?"h-full w-full relative border-none":"absolute opacity-0 w-0 h-0 overflow-hidden pointer-events-none",children:[(0,s.jsx)(q,{ref:c,className:b?"h-full w-full border-none bg-white":"absolute opacity-0 w-0 h-0 overflow-hidden pointer-events-none",content:b?t:void 0,type:b?o:void 0,onSandboxConfirmation:p,capabilities:m,onReportError:C,onSetContent:w,onRefresh:z}),b&&y&&(0,s.jsx)(R,{error:y,sendMessage:g?h:void 0,isStreaming:d})]}),void 0===t||void 0===o?null:o===i.JP.Code||r?(0,s.jsx)(a.Z,{className:"relative flex w-full flex-1 overflow-x-auto overflow-y-scroll",children:(0,s.jsx)(T,{content:t,isStreaming:d,language:n,sendMessage:h},"code-".concat(f,"-").concat(x,"-").concat(u))}):o===i.JP.Markdown?(0,s.jsx)(a.Z,{className:"relative flex w-full flex-1 overflow-x-hidden overflow-y-scroll",children:(0,s.jsx)(N,{content:t,isStreaming:d,sendMessage:h},"markdown-".concat(f,"-").concat(x,"-").concat(u))}):null]})},T=e=>{let{content:t,isStreaming:n,language:r,sendMessage:a}=e;return(0,s.jsx)(v,{isStreaming:n,sendMessage:a,contentType:"code",children:(0,s.jsx)(c.Z,{className:"code-block__code !my-0 h-fit min-h-full w-fit min-w-full !rounded-none !text-sm !leading-relaxed",language:r,PreTag:"div",style:u.Z,renderer:o.S,children:t})})},N=e=>{let{content:t,isStreaming:n,sendMessage:o}=e;return(0,s.jsx)(v,{isStreaming:n,sendMessage:o,children:(0,s.jsx)("div",{className:"font-claude-message mx-auto w-full max-w-3xl px-4 pb-8 pt-4 leading-[1.65rem] -tracking-[0.015em] md:px-8",children:(0,s.jsx)(r.ux,{text:t,className:"space-y-4"})})})}},61867:function(e,t,n){n.d(t,{KX:function(){return h},O3:function(){return b},P2:function(){return f},TD:function(){return y},q2:function(){return x},to:function(){return o},vr:function(){return m}});var s,o,r=n(15489),a=n(97712),i=n(3286);(s=o||(o={})).ReadyForContent="anthropic.claude.usercontent.sandbox.ReadyForContent",s.SetContent="anthropic.claude.usercontent.sandbox.SetContent",s.GetFile="anthropic.claude.usercontent.sandbox.GetFile",s.SendConversationMessage="anthropic.claude.usercontent.sandbox.SendConversationMessage",s.RunCode="anthropic.claude.usercontent.sandbox.RunCode",s.ClaudeCompletion="anthropic.claude.usercontent.sandbox.ClaudeCompletion",s.ReportError="anthropic.claude.usercontent.sandbox.ReportError";let l=a.z.object({type:a.z.literal("UnsupportedImports"),unsupportedModules:a.z.array(a.z.string()),nonExistentIcons:a.z.array(a.z.string())}),c=a.z.object({type:a.z.literal("RuntimeError"),message:a.z.string()}),u=a.z.object({type:a.z.literal("FileNotFound"),fileName:a.z.string()}),d=a.z.object({type:a.z.literal("ClaudeCompletionError"),message:a.z.string()}),p=a.z.discriminatedUnion("type",[l,c,u,d]),h=a.z.object({code:a.z.string()}),m=a.z.object({status:a.z.enum(["success","error"]),result:a.z.string().optional(),logs:a.z.array(a.z.string()),error:a.z.string().optional()}),g={"anthropic.claude.usercontent.sandbox.SetContent":{requestSchema:i.Zq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.SetContent"),payload:a.z.strictObject({"@type":a.z.union([a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.SandboxContent"),a.z.literal("anthropic.claude.usercontent.sandbox.SandboxContent")]),content:a.z.string(),type:a.z.nativeEnum(r.JP)})}),responseSchema:i.AY,alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.ReadyForContent":{requestSchema:i.Zq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.ReadyForContent"),payload:a.z.strictObject({"@type":a.z.union([a.z.literal("type.googleapis.com/google.protobuf.Empty"),a.z.literal("google.protobuf.Empty")])})}),responseSchema:i.AY,alwaysPermitted:!0},"anthropic.claude.usercontent.sandbox.GetFile":{requestSchema:i.Zq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.GetFile"),payload:a.z.strictObject({key:a.z.string(),"@type":a.z.union([a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.GetFileRequest"),a.z.literal("anthropic.claude.usercontent.sandbox.GetFileRequest")])})}),responseSchema:i.Tk.extend({payload:a.z.strictObject({value:a.z.instanceof(Uint8Array).nullable(),"@type":a.z.union([a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.GetFileResponse"),a.z.literal("anthropic.claude.usercontent.sandbox.GetFileResponse")])})}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.SendConversationMessage":{requestSchema:i.Zq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.SendConversationMessage"),payload:a.z.strictObject({message:a.z.string(),messageType:a.z.enum(["text","error"]),"@type":a.z.union([a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.SendConversationMessageRequest"),a.z.literal("anthropic.claude.usercontent.sandbox.SendConversationMessageRequest")])})}),responseSchema:i.AY,alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.RunCode":{requestSchema:i.Zq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.RunCode"),payload:a.z.strictObject({code:a.z.string(),"@type":a.z.union([a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.RunCodeRequest"),a.z.literal("anthropic.claude.usercontent.sandbox.RunCodeRequest")])})}),responseSchema:i.Tk.extend({payload:a.z.strictObject({"@type":a.z.union([a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.RunCodeResponse"),a.z.literal("anthropic.claude.usercontent.sandbox.RunCodeResponse")])}).merge(m)}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.ClaudeCompletion":{requestSchema:i.Zq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.ClaudeCompletion"),payload:a.z.strictObject({prompt:a.z.string(),"@type":a.z.union([a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.ClaudeCompletionRequest"),a.z.literal("anthropic.claude.usercontent.sandbox.ClaudeCompletionRequest")])})}),responseSchema:i.Tk.extend({payload:a.z.strictObject({completion:a.z.string().nullable(),"@type":a.z.union([a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.ClaudeCompletionResponse"),a.z.literal("anthropic.claude.usercontent.sandbox.ClaudeCompletionResponse")])})}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.ReportError":{requestSchema:i.Zq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.ReportError"),payload:a.z.strictObject({"@type":a.z.union([a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.ReportErrorRequest"),a.z.literal("anthropic.claude.usercontent.sandbox.ReportErrorRequest")]),error:p})}),responseSchema:i.AY,alwaysPermitted:!0}},f=a.z.enum(["anthropic.claude.usercontent.sandbox.ReadyForContent","anthropic.claude.usercontent.sandbox.GetFile","anthropic.claude.usercontent.sandbox.SendConversationMessage","anthropic.claude.usercontent.sandbox.ClaudeCompletion","anthropic.claude.usercontent.sandbox.ReportError"]),x=a.z.discriminatedUnion("method",[g["anthropic.claude.usercontent.sandbox.ReadyForContent"].requestSchema,g["anthropic.claude.usercontent.sandbox.GetFile"].requestSchema,g["anthropic.claude.usercontent.sandbox.SendConversationMessage"].requestSchema,g["anthropic.claude.usercontent.sandbox.ClaudeCompletion"].requestSchema,g["anthropic.claude.usercontent.sandbox.ReportError"].requestSchema]);a.z.union([i.AY,g["anthropic.claude.usercontent.sandbox.GetFile"].responseSchema,g["anthropic.claude.usercontent.sandbox.SendConversationMessage"].responseSchema,g["anthropic.claude.usercontent.sandbox.ClaudeCompletion"].responseSchema]),a.z.enum(["anthropic.claude.usercontent.sandbox.SetContent","anthropic.claude.usercontent.sandbox.RunCode"]),a.z.discriminatedUnion("method",[g["anthropic.claude.usercontent.sandbox.SetContent"].requestSchema,g["anthropic.claude.usercontent.sandbox.RunCode"].requestSchema]);let b=a.z.union([g["anthropic.claude.usercontent.sandbox.SetContent"].responseSchema,g["anthropic.claude.usercontent.sandbox.RunCode"].responseSchema]),y=Object.entries(g).filter(e=>{let[t,n]=e;return!0===n.alwaysPermitted}).map(e=>{let[t,n]=e;return t})},3286:function(e,t,n){n.d(t,{AY:function(){return l},D7:function(){return c},Kj:function(){return i},Tk:function(){return a},Zq:function(){return r},qV:function(){return o},v8:function(){return u}});var s=n(97712);let o=s.z.object({channel:s.z.enum(["request","response"]),requestId:s.z.string()}).passthrough(),r=o.strict().extend({channel:s.z.literal("request"),method:s.z.string(),payload:s.z.strictObject({"@type":s.z.string()})}),a=o.extend({channel:s.z.literal("response"),status:s.z.number().int().min(100).max(599),payload:s.z.strictObject({"@type":s.z.string()}).passthrough()}).passthrough(),i=a.extend({status:s.z.number().int().min(400).max(599),payload:s.z.strictObject({"@type":s.z.union([s.z.literal("anthropic.claude.usercontent.ErrorResponse"),s.z.literal("type.googleapis.com/anthropic.claude.usercontent.ErrorResponse")]),error:s.z.string()})}),l=a.extend({payload:s.z.strictObject({"@type":s.z.union([s.z.literal("google.protobuf.Empty"),s.z.literal("type.googleapis.com/google.protobuf.Empty")])})}),c={"@type":"type.googleapis.com/google.protobuf.Empty"},u=e=>({"@type":"type.googleapis.com/anthropic.claude.usercontent.ErrorResponse",error:e})},92829:function(e,t,n){n.d(t,{I:function(){return i}});var s=n(7653),o=n(61867),r=n(3286);class a{setupMessageListener(){window.addEventListener("message",this.boundHandleMessage,!1)}handleMessage(e){if(e.origin!==this.allowedOrigin||e.source!==this.iframe.contentWindow)return;let t=Date.now();if(t-this.lastResetTime>this.RESET_INTERVAL&&(this.messageCount=0,this.lastResetTime=t),this.messageCount++,this.messageCount>this.MAX_MESSAGES_PER_INTERVAL){window.removeEventListener("message",this.boundHandleMessage),this.onRateLimited&&this.onRateLimited();return}let n=r.qV.safeParse(e.data);if(!n.success){console.warn("Received message does not conform to basic message shape, ignoring");return}let s=n.data;if("response"===s.channel){this.handleResponse(s);return}this.messageQueue.push(s),this.isConsumerRunning||this.consumeMessages()}handleResponse(e){let t=this.inFlightRequests.get(e.requestId);if(void 0!==t){t(e);return}}async consumeMessages(){for(this.isConsumerRunning=!0;this.messageQueue.length>0;){let e=this.messageQueue.shift();if(!e)continue;let t=o.P2.safeParse(e.method);if(!t.success){this.sendErrorResponse(e.requestId,400,"Unknown method");continue}let n=t.data,s=o.q2.safeParse(e);if(!s.success){this.sendErrorResponse(e.requestId,400,"Invalid payload content");continue}let a=s.data;if(this.requestLog.has(a.requestId)){this.sendErrorResponse(a.requestId,400,"Request ID already processed");continue}this.requestLog.set(a.requestId,{message:a,requestTimestamp:new Date().getTime()}),await this.onPermissionRequested(n).then(e=>"denied"!==e||(this.sendErrorResponse(a.requestId,403,"Permission denied"),!1)).catch(e=>(console.error("Error checking permission for method ".concat(n,":"),e),this.sendErrorResponse(a.requestId,500,"Error checking permission"),!1))&&(this.onCapabilityAction(a,this.boundSendRequest).then(e=>{var t;let n=r.Tk.parse({channel:"response",status:200,requestId:a.requestId,payload:null!=e?e:r.D7}),s=this.requestLog.get(a.requestId);s&&this.requestLog.set(a.requestId,{...s,response:n,responseTimestamp:new Date().getTime()}),null===(t=this.iframe.contentWindow)||void 0===t||t.postMessage(n,this.allowedOrigin)}).catch(e=>{console.error("Error processing action for method ".concat(n,":"),e),this.sendErrorResponse(a.requestId,500,"Internal server error while processing action")}),await new Promise(e=>requestAnimationFrame(e)))}this.isConsumerRunning=!1}sendErrorResponse(e,t,n){var s;let o=r.Kj.parse({channel:"response",status:t,requestId:e,payload:(0,r.v8)(n)}),a=this.requestLog.get(e);a&&this.requestLog.set(e,{...a,response:o,responseTimestamp:new Date().getTime()}),null===(s=this.iframe.contentWindow)||void 0===s||s.postMessage(o,this.allowedOrigin)}restartListening(){window.removeEventListener("message",this.boundHandleMessage),this.messageCount=0,this.lastResetTime=Date.now(),this.setupMessageListener()}cleanup(){window.removeEventListener("message",this.boundHandleMessage),this.messageQueue=[],this.isConsumerRunning=!1,this.inFlightRequests.clear()}async sendRequest(e,t){return new Promise((n,s)=>{var a;let i=Date.now().toString();this.inFlightRequests.set(i,e=>{let t=r.Tk.safeParse(e);if(!t.success){s(Error("Invalid response format"));return}let a=t.data;if(a.status>=400){let e=r.Kj.safeParse(a);e.success?s(Error(e.data.payload.error)):s(Error("Error response (".concat(a.status,")")));return}let i=o.O3.safeParse(a);i.success?n(i.data.payload):s(Error("Invalid response payload for the method"))}),null===(a=this.iframe.contentWindow)||void 0===a||a.postMessage({channel:"request",method:e,requestId:i,payload:t},this.allowedOrigin)})}getRequestLog(){return Array.from(this.requestLog.entries()).map(e=>{let[t,n]=e;return{...n,requestId:t}}).sort((e,t)=>t.requestTimestamp-e.requestTimestamp)}constructor({iframe:e,allowedOrigin:t,onRateLimited:n=null,onPermissionRequested:s,onCapabilityAction:o}){this.messageCount=0,this.lastResetTime=Date.now(),this.MAX_MESSAGES_PER_INTERVAL=30,this.RESET_INTERVAL=5e3,this.onRateLimited=null,this.messageQueue=[],this.isConsumerRunning=!1,this.requestLog=new Map,this.inFlightRequests=new Map,this.iframe=e,this.allowedOrigin=t,this.onRateLimited=n,this.onPermissionRequested=s,this.onCapabilityAction=o,this.boundHandleMessage=this.handleMessage.bind(this),this.boundSendRequest=this.sendRequest.bind(this),this.setupMessageListener()}}function i(e){let{iframeRef:t,allowedOrigin:n,onRateLimited:r=null,initialPermissions:i,onPermissionRequested:l,onCapabilityAction:c}=e,[u,d]=(0,s.useState)(null),p=(0,s.useRef)(i);(0,s.useEffect)(()=>{if(t.current){let e=new a({iframe:t.current,allowedOrigin:n,onRateLimited:r,onPermissionRequested:async e=>{if(o.TD.includes(e)||"accepted"===p.current[e])return"accepted";let t=await l(e);return p.current={...p.current,[e]:t},t},onCapabilityAction:c});return d(e),()=>{e.cleanup()}}},[t,n,p,r,l,c]);let h=(0,s.useCallback)(async(e,t)=>{if(u)return u.sendRequest(e,t);throw Error("Communicator not initialized")},[u]),m=(0,s.useCallback)(()=>{null==u||u.restartListening()},[u]),g=(0,s.useCallback)((e,t)=>{p.current={...p.current,[e]:t}},[]);return{sendRequest:null===u?void 0:h,restartListening:m,permissions:p.current,updatePermission:g}}},2190:function(e,t,n){n.d(t,{E:function(){return r},N:function(){return a}});var s=n(24550);function o(e,t){let n=new Map;return t.forEach(e=>{var t;let s=null!==(t=n.get(e.file_name))&&void 0!==t?t:[];s.push(e),n.set(e.file_name,s)}),n.get(e)}let r=(e,t)=>{let n=o(e,t);if(!n||0===n.length)return null;let s=n[n.length-1];if(s){let e=s.extracted_content;return new TextEncoder().encode(e)}return null},a=async(e,t,n)=>{let r=o(e,t);if(!r||0===r.length)return null;let a=r.filter(e=>e.file_kind===s.Y.Blob);if(0===a.length)return null;let i=a[a.length-1];try{let e=await fetch("/api/organizations/".concat(n,"/files/").concat(i.file_uuid,"/contents"));if(!e.ok)return null;let t=await e.arrayBuffer();if(t.byteLength>2147483648-1)return null;return new Uint8Array(t)}catch(e){return null}}},97079:function(e,t,n){n.d(t,{C:function(){return s}});let s=async(e,t,n)=>{if(!t||!n)return Promise.resolve(null);try{let t=await fetch("/api/artifacts/api/".concat(n,"/completion"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:e})});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));let s=await t.json();return Promise.resolve(s.completion)}catch(e){return Promise.reject(e)}}},64914:function(e,t,n){var s=n(27573),o=n(7653);let r=(0,o.forwardRef)((e,t)=>{let{className:n,children:r,disabled:a}=e,i=(0,o.useRef)(0),l=(0,o.useRef)(!0),c=(0,o.useRef)(null),u=(0,o.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"auto";if(c.current&&l.current){if(c.current.scrollHeight-c.current.clientHeight<c.current.scrollTop)return;if(c.current&&"function"==typeof c.current.scrollTo){var t,n,s;null===(s=c.current)||void 0===s||s.scrollTo({top:(null===(t=c.current)||void 0===t?void 0:t.scrollHeight)-(null===(n=c.current)||void 0===n?void 0:n.clientHeight)+5,behavior:e})}}},[]);return(0,o.useImperativeHandle)(t,()=>({reset(){i.current=0,l.current=!0,u()},scrollToBottomIfPinned:u}),[u]),(0,o.useLayoutEffect)(()=>{!a&&r&&u()},[r,a,u]),(0,s.jsx)("div",{className:n,onScroll:e=>{if(a)return;let t=e.currentTarget.scrollTop,n=function(e,t){if(!e)return!1;{let n=e.scrollHeight-8;return Math.ceil(t+e.offsetHeight)>=Math.floor(n)}}(c.current,t),s=t>i.current;n&&s?l.current=!0:n||s||(l.current=!1),i.current=t},ref:c,children:r})});r.displayName="AutoScroll",t.Z=r}}]);