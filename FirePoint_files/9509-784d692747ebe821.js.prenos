"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9509],{64655:function(e,t,n){n.d(t,{HN:function(){return c},SE:function(){return s},Tx:function(){return l}});var i=n(89992),r=n(88075),a=n(49793),o=n(83056),u=n(27957);let c=(e,t)=>{let{account:n,activeOrganization:c}=(0,r.t)(),s=t===(null==n?void 0:n.uuid),l=null==c?void 0:c.uuid,d=(0,o.useQueryClient)(),f=(0,u.Gm)();return(0,i.uC)(()=>"/api/organizations/".concat(l,"/projects/").concat(e,"/accounts/").concat(t),"PUT",{onSuccess:()=>{d.invalidateQueries([a.l3,{projectUuid:e}]),s&&(f(e),d.invalidateQueries([a.VH,{orgUUID:l}]),d.invalidateQueries([a.tv,{orgUUID:l}]))}})},s=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],{activeOrganization:n}=(0,r.t)(),o=null==n?void 0:n.uuid;return(0,i.WE)("/api/organizations/".concat(o,"/projects/").concat(e,"/accounts"),{queryKey:[a.l3,{projectUuid:e}],enabled:!!(t&&n&&e),staleTime:0})},l=e=>{let{activeOrganization:t}=(0,r.t)(),n=null==t?void 0:t.uuid,u=(0,o.useQueryClient)();return(0,i.uC)(t=>"/api/organizations/".concat(n,"/projects/").concat(e,"/accounts/").concat(t.accountUuid),"PUT",{onSuccess:()=>{u.invalidateQueries([a.l3,{projectUuid:e}])},transformVariables:e=>({role:e.role})})}},48970:function(e,t,n){n.d(t,{ER:function(){return l},Kf:function(){return c},Zy:function(){return f},h4:function(){return p},op:function(){return d},pK:function(){return m},u3:function(){return s}});var i=n(89992),r=n(88075);n(65490);var a=n(44846),o=n(49793),u=n(83056);function c(e){let{projectUuid:t,suspense:n=!1}=e,{activeOrganization:a}=(0,r.t)(),u=null==a?void 0:a.uuid,{data:c,...s}=(0,i.WE)("/api/organizations/".concat(u,"/projects/").concat(t,"/docs"),{queryKey:[o.zy,{orgUuid:u,projectUuid:t}],enabled:!!a&&!!t,suspense:n});return{data:null==c?void 0:c.filter(e=>{let{file_name:t,content:n}=e;return t.length>0&&n.length>0}).filter(e=>{let{file_name:t}=e;return"[ANT ONLY] synced_resources.txt"!==t}),unfilteredData:c,...s}}function s(e){let{projectUuid:t}=e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{activeOrganization:a}=(0,r.t)(),c=null==a?void 0:a.uuid,s=(0,u.useQueryClient)();return(0,i.uC)(()=>"/api/organizations/".concat(c,"/projects/").concat(t,"/docs"),"POST",{enabled:!!t,onSuccess:function(){for(var e,i=arguments.length,r=Array(i),a=0;a<i;a++)r[a]=arguments[a];s.invalidateQueries([o.zy,{orgUuid:c,projectUuid:t}]),s.invalidateQueries([o.n$,{orgUuid:c}]),s.invalidateQueries([o.VH,{orgUUID:c}]),null===(e=n.onSuccess)||void 0===e||e.call(n,...r)},onError:function(){for(var e,t=arguments.length,i=Array(t),r=0;r<t;r++)i[r]=arguments[r];null===(e=n.onError)||void 0===e||e.call(n,...i)}})}function l(e){let{projectUuid:t}=e,{activeOrganization:n}=(0,r.t)(),a=null==n?void 0:n.uuid,c=(0,u.useQueryClient)();return(0,i.Ne)(e=>"/api/organizations/".concat(a,"/projects/").concat(t,"/docs/").concat(e.docUuid),"DELETE",(e,t)=>t?t.filter(t=>t.uuid!==e.docUuid):t,{queryKey:[o.zy,{orgUuid:a,projectUuid:t}],enabled:!!t,onSuccess:(e,n)=>{c.invalidateQueries([o.tt,{orgUuid:a,projectUuid:t,docUuid:n.docUuid}]),c.invalidateQueries([o.zy,{orgUuid:a,projectUuid:t}]),c.invalidateQueries([o.n$,{orgUuid:a}]),c.invalidateQueries([o.VH,{orgUUID:a}])}})}let d=e=>{let{projectUuid:t}=e,{activeOrganization:n}=(0,r.t)(),a=null==n?void 0:n.uuid,c=(0,u.useQueryClient)();return(0,i.Ne)(()=>"/api/organizations/".concat(a,"/projects/").concat(t,"/docs/delete_many"),"POST",(e,t)=>t?t.filter(t=>!e.doc_uuids.includes(t.uuid)):t,{queryKey:[o.zy,{orgUuid:a,projectUuid:t}],enabled:!!t,onSuccess:(e,n)=>{for(let e of n.doc_uuids)c.invalidateQueries([o.tt,{orgUuid:a,projectUuid:t,docUuid:e}]);c.invalidateQueries([o.zy,{orgUuid:a,projectUuid:t}]),c.invalidateQueries([o.n$,{orgUuid:a}]),c.invalidateQueries([o.VH,{orgUUID:a}])}})};function f(e){let{projectUuid:t}=e,{activeOrganization:n}=(0,r.t)(),a=null==n?void 0:n.uuid,c=(0,u.useQueryClient)();return(0,i.Ne)(e=>"/api/organizations/".concat(a,"/projects/").concat(t,"/docs/").concat(e.docUuid),"PUT",(e,t)=>t?t.map(t=>t.uuid===e.docUuid?{...t,...e}:t):t,{queryKey:[o.zy,{orgUuid:a,projectUuid:t}],enabled:!!t,onSuccess:(e,n)=>{c.invalidateQueries([o.tt,{orgUuid:a,projectUuid:t,docUuid:n.docUuid}]),c.invalidateQueries([o.zy,{orgUuid:a,projectUuid:t}]),c.invalidateQueries([o.n$,{orgUuid:a}]),c.invalidateQueries([o.VH,{orgUUID:a}])}})}function p(e){let{projectUuid:t}=e,{activeOrganization:n}=(0,r.t)(),a=null==n?void 0:n.uuid,c=(0,u.useQueryClient)();return(0,i.Ne)(()=>"/api/organizations/".concat(a,"/projects/").concat(t,"/files/delete_many"),"POST",(e,t)=>t?t.filter(t=>!e.file_uuids.includes(t.file_uuid)):t,{queryKey:[o.jb,{orgUuid:a,projectUuid:t}],enabled:!!t,onSuccess:()=>{c.invalidateQueries([o.jb,{orgUuid:a,projectUuid:t}]),c.invalidateQueries([o.n$,{orgUuid:a}]),c.invalidateQueries([o.VH,{orgUUID:a}])}})}function m(e){let{projectUuid:t}=e,{activeOrganization:n}=(0,r.t)(),u=null==n?void 0:n.uuid,{value:c}=(0,a.F)("ooc_attachments");return(0,i.WE)("/api/organizations/".concat(u,"/projects/").concat(t,"/files"),{queryKey:[o.jb,{orgUuid:u,projectUuid:t}],enabled:!!n&&!!t&&c})}},27957:function(e,t,n){n.d(t,{Gm:function(){return C},Kn:function(){return b},O3:function(){return p},Qs:function(){return h},Yc:function(){return g},bQ:function(){return m},dY:function(){return y},iR:function(){return w},u0:function(){return v}});var i=n(91014),r=n(89992),a=n(88075),o=n(65490),u=n(49793),c=n(83056),s=n(10751),l=n.n(s),d=n(7653),f=n(69602);let p=()=>{let{activeOrganization:e}=(0,a.t)(),t=(0,f.U)(),n=null==e?void 0:e.uuid;return(0,r.WE)("/api/organizations/".concat(n,"/projects"),{queryKey:[u.gi,{orgUuid:n}],enabled:!!(e&&t),staleTime:0,select:e=>e.filter(e=>!e.archived_at)})},m=()=>{let{data:e,isLoading:t}=p();return{data:null==e?void 0:e.filter(e=>e.is_starred),isLoading:t}},v=()=>{let{data:e,isLoading:t}=(0,i.QR)(),{data:n,isLoading:r}=p();return(0,d.useMemo)(()=>{if(t||r)return{data:n,isLoading:!0};if(!n||!e)return{data:n,isLoading:!1};let i=n.map(t=>({...t,lastConversation:null==e?void 0:e.find(e=>e.project_uuid===t.uuid)})).filter(e=>e.lastConversation).sort((e,t)=>new Date(t.lastConversation.created_at).getTime()-new Date(e.lastConversation.created_at).getTime()),a=null==n?void 0:n.filter(e=>!i.find(t=>t.uuid===e.uuid));return{data:[...i,...a],isLoading:!1}},[n,e,t,r])},g=e=>{let{projectUuid:t}=e,{activeOrganization:n}=(0,a.t)(),i=null==n?void 0:n.uuid;return(0,r.WE)("/api/organizations/".concat(i,"/projects/").concat(t),{queryKey:[u.$T,{orgUuid:i,projectUuid:t}],enabled:!!(n&&t),staleTime:0,meta:{noToast:e=>e instanceof o.Hx&&404===e.statusCode}})},h=()=>{let{activeOrganization:e}=(0,a.t)(),t=null==e?void 0:e.uuid,n=(0,c.useQueryClient)();return(0,r.uC)(()=>"/api/organizations/".concat(t,"/projects"),"POST",{onSuccess:()=>{n.invalidateQueries([u.gi,{orgUuid:t}]),n.invalidateQueries([u.n$,{orgUuid:t}])}})},y=e=>{let{projectUuid:t}=e,{activeOrganization:n}=(0,a.t)(),i=null==n?void 0:n.uuid,o=C();return(0,r.Ne)(()=>"/api/organizations/".concat(i,"/projects/").concat(t),"PUT",(e,t)=>t?{...t,...e}:void 0,{onSuccess:()=>{o(t)},queryKey:[u.$T,{orgUuid:i,projectUuid:t}]})},w=e=>{let{projectUuid:t}=e,{activeOrganization:n}=(0,a.t)(),i=null==n?void 0:n.uuid;return(0,r.WE)("/api/organizations/".concat(i,"/projects/").concat(t,"/conversations"),{queryKey:[u.lx,{orgUuid:i,projectUuid:t}],enabled:!!n,staleTime:0,select:e=>l()(e,e=>new Date(e.updated_at)).reverse()})},b=()=>{var e,t;let n=p(),i=null===(t=n.data)||void 0===t?void 0:null===(e=t.find(e=>e.is_starter_project))||void 0===e?void 0:e.uuid;return{...n,data:i}},C=()=>{let{activeOrganization:e}=(0,a.t)(),t=null==e?void 0:e.uuid,n=(0,c.useQueryClient)();return e=>{n.invalidateQueries([u.$T,{orgUuid:t,projectUuid:e}]),n.invalidateQueries([u.gi,{orgUuid:t}]),n.invalidateQueries([u.n$,{orgUuid:t}]),n.invalidateQueries([u.lx,{orgUuid:t,projectUuid:e}])}}},69602:function(e,t,n){n.d(t,{U:function(){return r}});var i=n(88075);let r=()=>{let e=(0,i.ZJ)();return(0,i.Cf)()||e}},63822:function(e,t,n){n.d(t,{M:function(){return l},Z:function(){return d}});var i=n(27573),r=n(32751),a=n(90345),o=n.n(a),u=n(7653);let c=(0,u.createContext)(null),s={getInstance:()=>void 0,removeInstance:o(),setBaseContent:o(),flagForDeletion:o(),registerEditor:o(),unregisterEditor:o(),setMergeState:()=>o(),subscribeToMergeStateChanges:()=>o()};function l(e){let{children:t}=e,n=(0,u.useRef)(new Map),a=(0,u.useCallback)(e=>{n.current.delete(e)},[]),o=(0,u.useRef)(new Set),s=(0,u.useCallback)((e,t)=>{n.current.set(e,{view:t})},[]),l=(0,u.useCallback)(e=>{n.current.delete(e)},[]),d=(0,u.useCallback)((e,t)=>{let i=n.current.get(e);if(!i){r.v("Attempted to set base content for unknown editor: ".concat(e));return}n.current.set(e,{...i,baseContent:t})},[]),f=(0,u.useCallback)(e=>{let t=n.current.get(e);if(!t){r.v("Attempted to flag for deletion for unknown editor: ".concat(e));return}n.current.set(e,{...t,filePendingDeletion:!0})},[]),p=(0,u.useCallback)((e,t)=>{let i=n.current.get(e);i&&(n.current.set(e,{...i,mergeState:t}),o.current.forEach(n=>{n(e,t)}))},[]),m=(0,u.useCallback)(e=>(o.current.add(e),()=>{o.current.delete(e)}),[]),v=(0,u.useCallback)(e=>n.current.get(e),[]),g=(0,u.useMemo)(()=>({getInstance:v,removeInstance:a,setBaseContent:d,flagForDeletion:f,registerEditor:s,unregisterEditor:l,setMergeState:p,subscribeToMergeStateChanges:m}),[v,a,d,f,s,l,p,m]);return(0,i.jsx)(c.Provider,{value:g,children:t})}function d(){return(0,u.useContext)(c)||s}},65380:function(e,t,n){n(35567)},2550:function(e,t,n){function i(e){var t;return(null===(t=e.mergeState)||void 0===t?void 0:t.isActive)?e.mergeState.diffSource||"":e.view.state.doc.toString()||""}function r(e){return i(e)!==e.baseContent}n.d(t,{li:function(){return i},oI:function(){return r}}),n(65380)},3909:function(e,t,n){n.d(t,{G:function(){return a}});var i=n(68068),r=n.n(i);function a(e){return r().createHash("sha256").update(e.trim()).digest("hex").slice(0,6)}},95950:function(e,t,n){n.d(t,{Y:function(){return u}});var i=n(88075),r=n(48644),a=n(64655),o=n(27957);let u=e=>{let{account:t}=(0,i.t)(),{data:n,isLoading:u}=(0,o.Yc)({projectUuid:e}),{data:c,isLoading:s}=(0,a.SE)(e||"");return null==c||c.some(e=>e.account.uuid===(null==t?void 0:t.uuid)&&"user"===e.role),"showDirectoryPicker"in window&&window,{userHasHarmony:!1,projectHasHarmony:!1,config:(0,r.useConfig)("harmony").config}}},51087:function(e,t,n){n.d(t,{C:function(){return d},b:function(){return f}});var i=n(27573),r=n(7653),a=n(90345),o=n.n(a);let u=(0,r.createContext)(null),c={openedFiles:[],projectDocs:[],files:[],setFiles:o(),projectUuid:"",syncedDirectories:[],setSyncedDirectories:o()};function s(e){let{children:t,onLoad:n}=e;return(0,r.useEffect)(n,[n]),(0,i.jsx)(u.Provider,{value:c,children:t})}n(20053),n(48970),n(769),n(13120),n(1373);var l=n(95950);function d(e){let{children:t,onLoad:n,projectUuid:r}=e,{userHasHarmony:a}=(0,l.Y)(r);return(0,i.jsx)(s,{onLoad:n,children:t})}function f(){return(0,r.useContext)(u)||c}},769:function(e,t,n){n(1373)},13120:function(e,t,n){n(20053),n(48970),n(65380),n(2550),n(3909),n(769),n(1373)},1373:function(e,t,n){n.d(t,{Wx:function(){return c},Xp:function(){return u}}),n(49456),n(36758);var i=n(32751);class r{static getInstance(){return r.instance||(r.instance=new r),r.instance}getCacheKey(e,t){return"".concat(e.name,"-").concat(t)}isPermissionExpired(e){return Date.now()-e>this.CACHE_DURATION}async checkPermission(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"read",n=this.getCacheKey(e,t),r=this.permissionCache.get(n);if(r&&!this.isPermissionExpired(r.timestamp))return"granted"===r.state;try{if("queryPermission"in e){let i=await e.queryPermission({mode:t});if("granted"===i)return this.permissionCache.set(n,{state:"granted",timestamp:Date.now(),mode:t}),!0}if("requestPermission"in e){let i=await e.requestPermission({mode:t});return this.permissionCache.set(n,{state:i,timestamp:Date.now(),mode:t}),"granted"===i}return this.permissionCache.set(n,{state:"granted",timestamp:Date.now(),mode:t}),!0}catch(e){return i.v("Permission check failed:",e),this.permissionCache.set(n,{state:"denied",timestamp:Date.now(),mode:t}),!1}}constructor(){this.permissionCache=new Map,this.CACHE_DURATION=36e5}}r.getInstance(),n(46385).Buffer;let a=new Map,o=(e,t)=>{a.size>=1e3&&Array.from(a.keys()).slice(0,Math.floor(200)).forEach(e=>a.delete(e)),a.set(e,t)};function u(e){if(a.has(e))return a.get(e);if(!e||""===e.trim())throw Error("Invalid URI: URI is undefined or empty");if(!e.startsWith("file://"))throw Error('Invalid URI: Must start with "file://"');try{let t=new URL(e),n=t.host,[i,r,a,...u]=t.pathname.split("/").map(decodeURIComponent);if(!n||!r||!a)throw Error("Invalid URI: Missing required components");let c={projectUuid:n,directoryUuid:r,directoryName:a,pathComponents:u};return o(e,c),c}catch(e){throw Error("Invalid URI: ".concat(e.message))}}function c(e){try{return u(e),!0}catch(e){return!1}}},49456:function(e,t,n){n.d(t,{CL:function(){return U},Jw:function(){return C},MR:function(){return f},Wr:function(){return y},dF:function(){return x},mD:function(){return g},tB:function(){return p},wI:function(){return o}});let i=[".DS_Store"],r=["jpg","jpeg","png","gif","webp"],a=["image/jpeg","image/png","image/gif","image/webp"],o={"image/jpeg":"jpg","image/png":"png","image/gif":"gif","image/webp":"webp"},u=["bmp","ico","tiff","tif","psd","raw","cr2","nef","orf","sr2","mobi","jp2","jpx","jpm","mj2","svg","svgz","ai","eps","ps","indd","heic","mp4","mov","avi","mkv","wmv","flv","webm","mpeg","mpg","m4v","3gp","ogv","ogg","rm","rmvb","asf","amv","mpe","m1v","m2v","svi","3g2","roq","nsv","f4v","f4p","f4a","f4b","qt","hdmov","divx","div","m2ts","mts","vob","mp3","wav","wma","aac","flac","alac","aiff","ogg","opus","m4a","amr","awb","wmv","ra","rm","mid","midi","mka","ttf","otf","woff","woff2","eot","sfnt","ttc","suit","zip","xls","xlsx","xlsb","xlm","xlsm","xlt","xltm","xltx","ods"],c=["txt","py","ipynb","js","jsx","html","css","java","cs","php","c","cc","cpp","cxx","h","hh","hpp","rs","R","Rmd","swift","go","rb","kt","kts","ts","tsx","m","mm","scala","rs","dart","lua","pl","pm","t","sh","bash","zsh","csv","log","ini","cfg","config","json","proto","yaml","yml","toml","lua","sql","bat","md","coffee","tex","latex","gd","gdshader","tres","tscn"],s=["docx","rtf","epub","html","odt","odp","pdf"],l=["application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/rtf","application/epub+zip","text/html","application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.presentation","application/pdf"],d=["csv"],f=3e7,p=e=>{let{imagesEnabled:t=!1}=e;return[".pdf",".doc",".docx",".rtf",".epub",".odt",".odp",".pptx",...v(),...t?m():[]]},m=()=>r.map(e=>".".concat(e)),v=()=>c.map(e=>".".concat(e)),g=e=>e.split(".").pop().toLowerCase(),h=(e,t)=>{let{imagesEnabled:n=!1}=t,i=g(e.name);return!!(!n&&(r.includes(i)||a.includes(e.type)))||u.includes(i)},y=e=>{let t=g(e.name);return r.includes(t)||a.includes(e.type)},w=e=>{let t=g(e.name);return d.includes(t)},b=e=>!!i.includes(e.name),C=(e,t)=>{let{imagesEnabled:n=!1,blobFileUploadsEnabled:i=!1,rasterizePdfUploadsEnabled:r}=t,a=[],o=[],u=[],c=[],s=[],l=[];return e.filter(e=>!b(e)).forEach(e=>{let t=n&&y(e);h(e,{imagesEnabled:n})?s.push(e):e.size>f?l.push(e):i&&w(e)?u.push(e):r&&("pdf"===g(e.name)||"application/pdf"===e.type)?c.push(e):x(e)?a.push(e):t?o.push(e):a.push(e)}),{attachmentUploads:a,imageUploads:o,rasterizedDocumentUploads:c,unsupportedUploads:s,tooLargeUploads:l,outOfContextFileUploads:u}},x=e=>{let t=g(e.name);return s.includes(t)||l.includes(e.type)},Q=e=>{let t=new Uint8Array(e);if(t.length>=4){if(239===t[0]&&187===t[1]&&191===t[2])return"utf-8";if(254===t[0]&&255===t[1]||255===t[0]&&254===t[1])return"utf-16";if(0===t[0]&&0===t[1]&&254===t[2]&&255===t[3]||255===t[0]&&254===t[1]&&0===t[2]&&0===t[3])return"utf-32"}let n=!0,i=Math.min(t.length-1,1e3);for(let e=0;e<i;e+=2)if(0===t[e]&&0===t[e+1]||0!==t[e]&&0!==t[e+1]){n=!1;break}if(n)return"utf-16";let r=!0,a=!1;for(let e=0;e<t.length;e++){let n=t[e];if(n>127){if(a=!0,(224&n)==192){if(e+1>=t.length||(192&t[e+1])!=128){r=!1;break}e+=1}else if((240&n)==224){if(e+2>=t.length||(192&t[e+1])!=128||(192&t[e+2])!=128){r=!1;break}e+=2}else if((248&n)==240){if(e+3>=t.length||(192&t[e+1])!=128||(192&t[e+2])!=128||(192&t[e+3])!=128){r=!1;break}e+=3}else{r=!1;break}}}if(r&&a)return"utf-8";let o=(e=>{let t={ascii:0,nonAscii:0,cyrillic:0,latin1:0,control:0,total:Math.min(e.length,4e3)};for(let n=0;n<t.total;n++){let i=e[n];i<32?t.control++:i<127?t.ascii++:i>127&&(t.nonAscii++,(i>=192&&i<=255||i>=168&&i<=183)&&t.cyrillic++,(i>=128&&i<=159||i>=160&&i<=255)&&t.latin1++)}return t})(t),u=o.cyrillic/o.total*100,c=o.latin1/o.total*100,s=o.ascii/o.total*100;if(o.nonAscii>0){if(u>.3)return"windows-1251";if(c>o.control/o.total*100)return"windows-1252"}return s>90&&o.control/o.total<.1?"ascii":"utf-8"},U=async e=>{let t=await e.arrayBuffer(),n=Q(t);try{return new TextDecoder(n,{fatal:!0}).decode(t)}catch(e){if("utf-8"!==n)return new TextDecoder("utf-8",{fatal:!0}).decode(t)}throw Error("Failed to decode file as plain text")}},32751:function(e,t,n){function i(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n]}function r(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n]}n.d(t,{f:function(){return i},v:function(){return r}})}}]);