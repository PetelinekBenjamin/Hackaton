"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[123],{23232:function(e,t,n){n.d(t,{P9:function(){return _},Vw:function(){return p},aP:function(){return m},cE:function(){return g},fg:function(){return h},us:function(){return v}});var a=n(89992),r=n(88075),o=n(65490),i=n(71854),l=n(49793),s=n(99694),u=n(83056),c=n(23428),d=n(71894);let f=e=>{if(e instanceof o.Hx)return e instanceof o.Hx&&403===e.statusCode&&"permission_error"===e.type&&e.message.match(/Google Drive/)},m=e=>{let{activeOrganization:t}=(0,r.t)(),n=null==t?void 0:t.uuid;return(0,a.Nl)(e.map(e=>"/api/organizations/".concat(n,"/sync/chat/").concat(e)),{queryKey:e.map(e=>[l.cF,{orgUuid:n,syncSourceUuid:e}]),enabled:!!(t&&e.length>0),refetchInterval:e=>!!(e&&(0,c.sf)(e))&&5e3,meta:{noToast:!0}})},p=e=>!!e.some(e=>e.isLoading)||e.some(e=>e.data&&(0,c.sf)(e.data)),h=e=>Math.ceil(m(e).reduce((e,t)=>{var n,a,r;return t.isLoading||!t.data?e:e+(null!==(r=null===(a=t.data)||void 0===a?void 0:null===(n=a.status)||void 0===n?void 0:n.current_size_bytes)&&void 0!==r?r:0)},0)/i.r6),g=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{account:t,activeOrganization:n}=(0,r.t)(),o=null==t?void 0:t.uuid,i=null==n?void 0:n.uuid,c=(0,u.useQueryClient)();return(0,a.uC)(()=>"/api/organizations/".concat(i,"/sync/chat"),"POST",{enabled:!!n,...e,onSuccess:function(){for(var t,n,a,r,u,d=arguments.length,f=Array(d),m=0;m<d;m++)f[m]=arguments[m];let[p]=f;c.setQueryData([l.cF,{orgUuid:i,syncSourceUuid:p.uuid}],p),p.type===s.F.GDRIVE&&p.config.uri&&(null===(t=p.status)||void 0===t?void 0:t.extra)&&(null===(n=p.status)||void 0===n?void 0:n.current_size_bytes)&&c.setQueryData([l.Yp,{accountUUID:o,orgUUID:i,documentId:p.config.uri}],{uri:"drive:///".concat(p.config.uri),title:null===(r=p.status)||void 0===r?void 0:r.extra,size:null===(u=p.status)||void 0===u?void 0:u.current_size_bytes}),null===(a=e.onSuccess)||void 0===a||a.call(e,...f)},onError:function(){for(var t,n=arguments.length,a=Array(n),r=0;r<n;r++)a[r]=arguments[r];null===(t=e.onError)||void 0===t||t.call(e,...a);let[o,i]=a;f(o)&&i.sync_source_type===s.F.GDRIVE&&(0,d.ZZ)(i.sync_source_config.uri)}})},_=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:t}=(0,r.t)(),n=null==t?void 0:t.uuid,o=(0,u.useQueryClient)();return(0,a.uC)(()=>"/api/organizations/".concat(n,"/sync/chat"),"PUT",{enabled:!!t,...e,onSuccess:function(){for(var t,a=arguments.length,r=Array(a),i=0;i<a;i++)r[i]=arguments[i];let[s]=r;o.setQueryData([l.cF,{orgUuid:n,syncSourceUuid:s.uuid}],s),null===(t=e.onSuccess)||void 0===t||t.call(e,...r)}})},v=()=>{let{activeOrganization:e}=(0,r.t)(),t=null==e?void 0:e.uuid;return(0,a.uC)(e=>"/api/organizations/".concat(t,"/sync/chat/").concat(e),"DELETE",{enabled:!!e})}},6274:function(e,t,n){n.d(t,{AQ:function(){return h},IP:function(){return f},gr:function(){return u},l2:function(){return c},yg:function(){return m},zB:function(){return d}});var a=n(89992),r=n(88075),o=n(44846),i=n(49793),l=n(83056),s=n(23428);let u=function(e){let{projectUuid:t}=e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{activeOrganization:o}=(0,r.t)(),i=null==o?void 0:o.uuid,l=p();return(0,a.uC)(()=>"/api/organizations/".concat(i,"/projects/").concat(t,"/syncs"),"POST",{enabled:!!(o&&t),...n,onSuccess:function(){for(var e,a=arguments.length,r=Array(a),o=0;o<a;o++)r[o]=arguments[o];l(t),null===(e=n.onSuccess)||void 0===e||e.call(n,...r)},onError:function(){for(var e,t=arguments.length,a=Array(t),r=0;r<t;r++)a[r]=arguments[r];null===(e=n.onError)||void 0===e||e.call(n,...a)}})},c=function(e){let{projectUuid:t}=e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{activeOrganization:o}=(0,r.t)(),i=null==o?void 0:o.uuid,l=p();return(0,a.uC)(()=>"/api/organizations/".concat(i,"/projects/").concat(t,"/syncs"),"PUT",{enabled:!!(o&&t),...n,onSuccess:function(){for(var e,a=arguments.length,r=Array(a),o=0;o<a;o++)r[o]=arguments[o];l(t),null===(e=n.onSuccess)||void 0===e||e.call(n,...r)}})},d=e=>{let{projectUuid:t}=e,{activeOrganization:n}=(0,r.t)(),o=null==n?void 0:n.uuid,l=p();return(0,a.Ne)(e=>"/api/organizations/".concat(o,"/projects/").concat(t,"/syncs/").concat(e),"DELETE",(e,t)=>t?t.filter(t=>t.uuid!==e):t,{queryKey:[i.AI,{orgUuid:o,projectUuid:t}],enabled:!!n,onSuccess:()=>{l(t)}})},f=e=>{let{projectUuid:t}=e,{activeOrganization:n}=(0,r.t)(),o=null==n?void 0:n.uuid,l=p();return(0,a.Ne)(()=>"/api/organizations/".concat(o,"/projects/").concat(t,"/syncs/delete_many"),"POST",(e,t)=>t?t.filter(t=>!e.sync_source_uuids.includes(t.uuid)):t,{queryKey:[i.AI,{orgUuid:o,projectUuid:t}],enabled:!!n,onSuccess:()=>{l(t)}})},m=e=>{let{activeOrganization:t}=(0,r.t)(),{value:n}=(0,o.F)("nighthawk_enabled"),{value:l}=(0,o.F)("kingfisher_enabled"),{value:u}=(0,o.F)("spider_enabled_2"),c=null==t?void 0:t.uuid,d=(n||l||u)&&!!t&&!!e,{data:f,isLoading:m}=(0,a.WE)("/api/organizations/".concat(c,"/projects/").concat(e,"/syncs"),{queryKey:[i.AI,{orgUuid:c,projectUuid:e}],enabled:d,refetchInterval:e=>(null==e?void 0:e.some(s.sf))?5e3:3e5});return{data:f,isLoading:!!d&&m}},p=()=>{let{activeOrganization:e}=(0,r.t)(),t=null==e?void 0:e.uuid,n=(0,l.useQueryClient)();return e=>{n.invalidateQueries([i.AI,{orgUuid:t,projectUuid:e}]),n.invalidateQueries([i.Xg,{orgUuid:t,projectUuid:e}])}},h=e=>{let{data:t}=m(e);return!!(null==t?void 0:t.some(s.sf))}},58708:function(e,t,n){n.d(t,{GB:function(){return s},HK:function(){return d},KM:function(){return c},fq:function(){return u},h9:function(){return l}});var a=n(89992),r=n(88075),o=n(49793),i=n(83056);let l=()=>{let{activeOrganization:e}=(0,r.t)(),t=null==e?void 0:e.uuid;return(0,a.WE)("/api/organizations/".concat(t,"/list_styles"),{queryKey:[o.it,{orgUUID:t}]})},s=()=>{let{activeOrganization:e}=(0,r.t)(),t=null==e?void 0:e.uuid,n=(0,i.useQueryClient)();return(0,a.uC)("/api/organizations/".concat(t,"/styles/create"),"POST",{onSuccess:()=>{n.invalidateQueries([o.it,{orgUUID:t}])}})},u=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],{activeOrganization:n}=(0,r.t)(),l=null==n?void 0:n.uuid,s=(0,i.useQueryClient)();return(0,a.uC)("/api/organizations/".concat(l,"/styles/").concat(e,"/edit"),"PUT",{onSuccess:()=>{s.invalidateQueries([o.it,{orgUUID:l}])},enabled:!t})},c=e=>{let{activeOrganization:t}=(0,r.t)(),n=null==t?void 0:t.uuid,l=(0,i.useQueryClient)();return(0,a.uC)("/api/organizations/".concat(n,"/styles/").concat(e,"/delete"),"DELETE",{onSuccess:()=>{l.invalidateQueries([o.it,{orgUUID:n}])}})},d=()=>{let{activeOrganization:e}=(0,r.t)(),t=null==e?void 0:e.uuid;return(0,a.uC)("/api/organizations/".concat(t,"/styles/preview"),"POST")}},50987:function(e,t,n){n.d(t,{x:function(){return b},r:function(){return y}});var a=n(27573),r=n(98635),o=n(64969),i=n(89992),l=n(7653),s=n(23232),u=n(48970),c=n(6274),d=n(63822),f=n(95950),m=n(51087);n(13120);var p=n(79373),h=n(20504);let g=e=>!!e&&("INPUT"===e.tagName||"TEXTAREA"===e.tagName||"true"===e.getAttribute("contenteditable")||"textbox"===e.getAttribute("role")),_=e=>{let t=(0,l.useCallback)(t=>{if(!(!e||g(document.activeElement))&&1===t.key.length&&!t.ctrlKey&&!t.altKey&&!t.metaKey){var n;t.preventDefault(),null===(n=e.getEditor())||void 0===n||n.chain().insertContent(t.key).focus().run()}},[e]);(0,l.useEffect)(()=>(document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)),[t])},v=l.createContext({attachments:[],files:[],syncSourceUuids:[],isAtMaxNumUploads:!1,model:"",prompt:"",projectUuid:void 0,isChatSyncing:!1,personalizedStyle:void 0,isProjectSyncing:!1,isProjectLocked:!1,isSending:!1,setPrompt:()=>void 0,setAttachments:()=>void 0,setFiles:()=>void 0,setSyncSourceUuids:()=>void 0,setModel:()=>Promise.resolve(),setProjectUuid:()=>void 0,sendMessage:()=>void 0,stopSampling:()=>void 0,conversation:void 0,focusInput:()=>void 0,promptInputRef:{current:null},willRedirectOnSubmit:!1,hasBlockingWarning:!1,setHasBlockingWarning:()=>void 0,setPersonalizedStyle:()=>void 0,isUploadingDriveSync:!1,isUploadingGithubSync:!1,setIsUploadingDriveSync:()=>void 0,setIsUploadingGithubSync:()=>void 0}),y=()=>l.useContext(v),b=e=>{var t,n;let g=(0,l.useRef)(null),y="conversation"in e,{children:b,projectUuid:w,namespace:C}=e,S=y?e.conversation:void 0;_(g.current);let{input:x,setInput:k,attachments:T,setAttachments:E,files:P,setFiles:j,syncSourceUuids:O,setSyncSourceUuids:D,clear:I}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0,a=n?"".concat(n,":"):"",[r,o,i]=(0,h.Rr)("".concat(a).concat(e,":attachment"),[]),[s,u,c]=(0,h.Rr)("".concat(a).concat(e,":files"),[]),[d,f,m]=(0,h.Rr)("".concat(a).concat(e,":syncSourceUuids"),[]),[p,g,_]=(0,h.Rr)("".concat(a).concat(e,":textInput"),t);return{attachments:r,setAttachments:o,files:s,setFiles:u,syncSourceUuids:d,setSyncSourceUuids:f,input:p,setInput:g,clear:(0,l.useCallback)(()=>{_(),i(),c(),m()},[i,_,c,m])}}(null!==(t=null==S?void 0:S.id)&&void 0!==t?t:void 0===w?"new-conversation":"".concat(w,":conversation"),"",C),z=(0,s.aP)(O),U=(0,s.Vw)(z),Q=(0,i.Wk)(z),N=T.length+O.length>=r.Qe,[A,M]=l.useState(null==S?void 0:S.model),{stickyModelPreference:R}=(0,o.M)();(0,l.useEffect)(()=>{!A&&R&&M(R)},[R,A,M]);let[L,F]=l.useState(w),H=(0,c.AQ)(L),[Z,W]=l.useState(!1),[V,Y]=l.useState(!1),[B,J]=l.useState(!1),{storedStyle:K,defaultStyle:G}=(0,p.O)(),[q,X]=l.useState();(0,l.useEffect)(()=>{let e=null!=K?K:G;!q&&e&&X(e)},[K,G,q]);let $="setPersonalizedStyleCallback"in e?e.setPersonalizedStyleCallback:null;(0,l.useEffect)(()=>{null==$||$(q)},[q,$]);let{projectHasHarmony:ee}=(0,f.Y)(L),{openedFiles:et,projectDocs:en,projectUuid:ea}=(0,m.b)(),{getInstance:er}=(0,d.Z)(),{mutateAsync:eo}=(0,u.u3)({projectUuid:ea}),{mutateAsync:ei}=(0,u.Zy)({projectUuid:ea}),el=async()=>{if(g.current&&(""!==x.trim()||0!==T.length||0!==P.length||0!==O.length)){I(),e.willRedirectOnSubmit?g.current.setEditable(!1):g.current.setContent(""),W(!0);try{y?await e.onSend({prompt:x,attachments:T,files:P,syncSources:Q,personalized_style:q}):await e.onCreate({prompt:x,attachments:T,files:P,syncSources:Q,model:A,project_uuid:L,personalized_style:q})}catch(e){var t;k(x),null===(t=g.current)||void 0===t||t.setContent(x),E(T),j(P),D(O),g.current.setEditable(!0)}finally{W(!1)}}},es=async t=>{if(M(t),y){W(!0);try{await e.onCreate({prompt:x,attachments:T,files:P,syncSources:Q,model:t,project_uuid:L})}finally{W(!1)}}},[eu,ec]=l.useState(!1);return(0,a.jsx)(v.Provider,{value:{prompt:x,attachments:T,files:P,syncSourceUuids:O,isAtMaxNumUploads:N,isUploadingDriveSync:V,isUploadingGithubSync:B,model:A,projectUuid:L,isChatSyncing:U,personalizedStyle:q,isProjectSyncing:H,isProjectLocked:void 0!==w||void 0!==S,isSending:Z,setPrompt:function(e){let{forceUpdateTiptap:t=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(k(e),!0===t){var n;null===(n=g.current)||void 0===n||n.setContent(e)}},setAttachments:e=>E(e),setFiles:e=>j(e),setSyncSourceUuids:e=>D(e),setModel:es,setProjectUuid:F,sendMessage:el,stopSampling:()=>{y&&e.onStopSampling()},conversation:S,focusInput:()=>{var e;return null===(e=g.current)||void 0===e?void 0:e.focus()},promptInputRef:g,willRedirectOnSubmit:null!==(n=e.willRedirectOnSubmit)&&void 0!==n&&n,hasBlockingWarning:eu,setHasBlockingWarning:ec,setPersonalizedStyle:X,setIsUploadingDriveSync:Y,setIsUploadingGithubSync:J},children:b})}},79373:function(e,t,n){n.d(t,{O:function(){return i},g:function(){return o}});var a=n(20504),r=n(58708);let o=(e,t)=>"default"===e.type&&e.key===t||"custom"===e.type&&e.uuid===t,i=()=>{let{data:e,isLoading:t}=(0,r.h9)(),n=(null==e?void 0:e.defaultStyles)||[],i=[...n,...(null==e?void 0:e.customStyles)||[]],l=null==e?void 0:e.text,[s,u,c]=(0,a.Rr)("claude_personalized_style",null);if(t||!(null==i?void 0:i.length))return{personalizedStyleOptions:[],defaultStyle:null,storedStyle:null,setStoredStyle:u,clearStoredStyle:c,text:l};let d=n.length?n.find(e=>!0===e.isDefault)||n[0]:null;if(!s)return{personalizedStyleOptions:i,defaultStyle:d,storedStyle:s,setStoredStyle:u,clearStoredStyle:c,text:l};let f=i.find(e=>o(e,s.styleKey)),m=Date.now()-new Date(s.timestamp).getTime()>432e5;return{personalizedStyleOptions:i,storedStyle:f&&!m?f:null,defaultStyle:d,setStoredStyle:u,clearStoredStyle:c,text:l}}},73567:function(e,t,n){n.d(t,{Ck:function(){return v},IR:function(){return m},Pd:function(){return p},Uc:function(){return g},W1:function(){return u},_y:function(){return h},fb:function(){return w},gq:function(){return b},k7:function(){return y},ml:function(){return f},wO:function(){return c},yU:function(){return d},yq:function(){return _}});var a=n(89992),r=n(51571),o=n(17741),i=n(49793),l=n(83056),s=n(67754);function u(e,t){return(0,a.WE)("/api/auth/login_methods?email=".concat(e,"&source=").concat(t),{enabled:!!e&&(0,o.vV)(e),meta:{noToast:!0}})}let c=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,r.Z)();return(0,a.uC)("/api/auth/send_magic_link","POST",{...e,transformVariables:e=>({...e,source:t?"claude":"console"})})},d=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,r.Z)();return(0,a.uC)("/api/auth/exchange_nonce_for_code","POST",{...e,transformVariables:e=>({...e,source:t?"claude":"console"})})},f=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,r.Z)();return(0,a.uC)("/api/auth/verify_magic_link","POST",{...e,transformVariables:e=>({...e,source:t?"claude":"console"})})},m=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,r.Z)(),n=(0,s.useRouter)();return(0,a.uC)("/api/auth/verify_google","POST",{...e,onSuccess:(t,a,r)=>{!t.success&&t.sso_url?n.push(t.sso_url):e.onSuccess&&e.onSuccess(t,a,r)},transformVariables:e=>({...e,source:t?"claude":"console"})})},p=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,r.Z)();return(0,a.uC)("/api/auth/accept_invite","POST",{...e,transformVariables:e=>({...e,source:t?"claude":"console"})})},h=()=>(0,a.uC)("/api/auth/logout","POST"),g=()=>(0,a.uC)("/api/auth/logout/all-sessions","POST"),_=()=>{let e=(0,l.useQueryClient)();return(0,a.uC)("/api/account","PUT",{async onSuccess(){await e.invalidateQueries([i.aY])}})},v=()=>(0,a.Ne)("/api/account","PUT",(e,t)=>(null==t?void 0:t.account)?{...t,account:{...t.account,settings:e}}:t,{queryKey:[i.aY],transformVariables:e=>({settings:e})}),y=()=>{let e=(0,l.useQueryClient)();return(0,a.uC)("/api/account/accept_legal_docs","PUT",{async onSuccess(){await e.invalidateQueries([i.aY])}})};function b(e){return(0,a.WE)("/api/signups/".concat(e),{enabled:!!e,staleTime:0})}function w(e,t,n){return(0,a.WE)("/api/enterprise_auth/sso_callback?code=".concat(e,"&state=").concat(t,"&source=").concat(n),{meta:{noToast:!0}})}},98635:function(e,t,n){n.d(t,{Ch:function(){return O},H0:function(){return Z},Qe:function(){return E},Qt:function(){return Q},Vn:function(){return R},kS:function(){return I},sE:function(){return U}});var a=n(85565),r=n(27573),o=n(73567),i=n(89992),l=n(88075),s=n(24658),u=n(92973),c=n(17886),d=n(3520),f=n(65490),m=n(71854),p=n(44846),h=n(36222),g=n(95166),_=n(27222),v=n(13623),y=n(7653),b=n(48644),w=n(2319),C=n(49456),S=n(27920),x=n(23489),k=n(34016);function T(){let e=(0,a._)(["\n  relative\n  grid\n  place-content-center\n  aspect-square\n  rounded-xl\n  cursor-pointer\n  transition\n  [fieldset:not(:disabled)_&]:hover:bg-bg-400\n  [fieldset:disabled_&]:opacity-50\n  [fieldset:disabled_&]:pointer-events-none\n  focus-within:ring\n  inline-flex\n  items-center\n  justify-center\n  relative\n  shrink-0\n  ring-offset-2\n  ring-offset-bg-300\n  ring-accent-main-100\n  focus-visible:outline-none\n  focus-visible:ring-1\n  disabled:pointer-events-none\n  disabled:opacity-50\n  disabled:shadow-none\n  disabled:drop-shadow-none\n  bg-[radial-gradient(ellipse,_var(--tw-gradient-stops))]\n  from-bg-500/10\n  from-50%\n  to-bg-500/30\n  border-0.5\n  border-border-400\n  font-medium\n  font-styrene\n  text-text-100/90\n  transition-colors\n  active:bg-bg-500/50\n  hover:text-text-000\n  hover:bg-bg-500/60\n"]);return T=function(){return e},e}let E=5,P=e=>{let t=e.webkitRelativePath;return t&&t.length?t:e.name},j=e=>e.replace(/\0/g,""),O=e=>{e.extracted_content=j(e.extracted_content),e.file_name=j(e.file_name),e.file_type=j(e.file_type)},D=(e,t)=>({file_name:P(e),file_type:e.type,file_size:e.size,extracted_content:t});function I(e){let{syncSourceCount:t,files:n,setFiles:a,numExistingConversationFiles:o,attachments:i,setAttachments:l,numExistingConversationAttachments:u,detectSameAttachment:d,selectedModel:f,blobFileUploadsEnabled:m}=e,{addError:p}=(0,s.e)(),v=(0,S.wN)(null);return function(e){let{syncSourceCount:t,onUploadComplete:n,existingAttachments:a,existingFiles:o,numExistingConversationAttachments:i,numExistingConversationFiles:l,selectedModel:s,blobFileUploadsEnabled:u}=e,{modelConfig:d}=(0,x.V)(s),f=d.image_in,[m,p,v,b]=function(e){let{syncSourceCount:t,onUploadComplete:n,existingAttachments:a,existingFiles:r,numExistingConversationFiles:o,selectedModel:i,blobFileUploadsEnabled:l}=e,{modelConfig:s}=(0,x.V)(i),u=s.image_in,c=Z()&&s.pdf_in,{isUploading:d,setIsUploading:f,handleError:m,handleUpload:p}=R({imagesEnabled:u,blobFileUploadsEnabled:l,onUploadComplete:n,rasterizePdfUploadsEnabled:c}),g=(0,y.useCallback)(e=>{let{newUploads:n=[],numNewPotentialAttachments:i=0,showError:s=!0}=e,{attachmentUploads:d,imageUploads:f,rasterizedDocumentUploads:p,outOfContextFileUploads:g}=(0,C.Jw)(n,{imagesEnabled:u,blobFileUploadsEnabled:l,rasterizePdfUploadsEnabled:c});return i+d.length+f.length+p.length+g.length+a.length+r.length+t>E?(s&&m("You can add at most ".concat((0,h.M0)(E,"attachment")," to a message. Please select fewer attachments.")),!1):!(f.length+p.length+r.length+o>100)||(s&&m("You can add at most ".concat((0,h.M0)(100,"file")," to a chat. ").concat(o<100?"Please select fewer files.":"Please consider starting a new chat.")),!1)},[u,l,a,r,t,o,m,c]);return[d,f,g,(0,y.useCallback)(async e=>{g({newUploads:e})&&await p(e)},[p,g])]}({syncSourceCount:t,onUploadComplete:n,existingFiles:o,existingAttachments:a,numExistingConversationFiles:l,numExistingConversationAttachments:i,selectedModel:s,blobFileUploadsEnabled:u}),w=function(e){let{handleUpload:t}=e,n=(0,y.useRef)({ready:0,total:0}),a=(0,y.useCallback)(()=>{n.current={ready:0,total:0}},[]),r=(0,y.useCallback)(e=>{n.current.ready+=1,n.current.total===n.current.ready&&t(e)},[t]),o=(0,y.useCallback)((e,t)=>{let a=e.length;for(let i=0;i<a;i++){let a=e[i];a.isFile?(n.current.total+=1,a.file(e=>{t.push(e),r(t)})):a.isDirectory&&a.createReader().readEntries(e=>{o(e,t)})}},[r]);return(0,y.useCallback)(e=>{var t;e.preventDefault(),a();let n=null===(t=e.dataTransfer)||void 0===t?void 0:t.items;if(!n)return;let r=[];for(let e=0;e<(null==n?void 0:n.length);e++){let t=n[e].webkitGetAsEntry();t&&r.push(t)}o(r,[])},[o,a])}({handleUpload:b}),S=(0,y.useCallback)(async e=>{await b(Array.from(e))},[b]),k=(0,y.useCallback)(async e=>{let t=e.target.files;t&&await b(Array.from(t)),e.target.value=""},[b]),T=f?"Upload docs or images to Claude\n(Max ".concat(E,", 30mb each)"):"Add content (".concat(E," max, 30mb each)\nAccepts pdf, txt, csv, etc."),P={type:"file",accept:(0,C.tB)({imagesEnabled:f}).join(","),onChange:e=>{k(e)},multiple:!0,"aria-label":"Upload files"};return[m,p,v,w,S,b,(0,r.jsx)(c.Z,{className:"text-center",tooltipContent:T,children:(0,r.jsxs)(L,{children:[(0,r.jsx)("input",{"data-testid":"file-upload",className:"absolute inset-0 -z-10 overflow-hidden rounded-xl opacity-0",...P}),m?(0,r.jsx)(g.U,{className:"animate-spin",size:18}):(0,r.jsx)(_.p,{size:18,weight:"light"})]})},"upload-tooltip"),P]}({syncSourceCount:t,onUploadComplete:(0,y.useCallback)(async(e,t)=>{d&&e.find(e=>d(e.extracted_content))&&p("The same attachment was already added earlier. Claude sees the full conversation when replying, so there’s no need to re-upload."),l(t=>[...t,...e]),a(e=>[...e,...t])},[l,d,p,a]),existingAttachments:i,existingFiles:n,numExistingConversationAttachments:u,numExistingConversationFiles:o,selectedModel:null!=f?f:v,blobFileUploadsEnabled:m})}let z=async(e,t,n)=>{let a=new Image;if(a.src=URL.createObjectURL(e),await new Promise(e=>{a.onload=e,setTimeout(e,250)}),!a.width||!a.height||"image/png"!==e.type&&a.width<=t&&a.height<=n)return e;let r=a.width/a.height,o=a.width,i=a.height;a.width>t&&(i=(o=t)/r),i>n&&(o=(i=n)*r);let l=document.createElement("canvas");l.style.display="none",document.body.appendChild(l);let s=l.getContext("2d");if(!s||!s.imageSmoothingQuality)return document.body.removeChild(l),e;s.imageSmoothingQuality="high",l.width=o,l.height=i,s.drawImage(a,0,0,o,i);let u=await new Promise(e=>{l.toBlob(t=>e(t),"image/webp",.85)});return(document.body.removeChild(l),u)?new File([u],e.name,{type:"image/webp"}):e},U=()=>{let{value:e}=(0,p.F)("use_canvas_resize");return(0,y.useCallback)(async t=>e?await z(t,2e3,2e3):t,[e])},Q=()=>{let e=H(),t=A();return async(n,a,r)=>{try{return await t(n,a,r)}catch(t){e(t,(0,C.Wr)(n)?"image":"file")}}},N=e=>{let t=H(),n=A(),a=(0,i.OJ)();return async(r,o)=>{let i={};try{i.file=await n(r,o)}catch(n){n instanceof f.Hx&&"document_too_many_pages"===n.errorCode?i.attachment=await F(a,r,o,e):t(n,"document")}return i}},A=()=>{let e=(0,i.OJ)();return async(t,n,a)=>{let r=new FormData;r.append("file",t);let o=a?"/api/organizations/".concat(n,"/projects/").concat(a,"/upload"):"/api/".concat(n,"/upload"),i=await e(o,{method:"POST",body:r}),l=await i.json();if(i.ok)return l;throw(0,f.fT)(i.status,l,"File upload failed",i.headers)}},M=async(e,t,n,a)=>{let r;let o=new FormData;o.append("file",t);try{r=await e("/api/organizations/".concat(n,"/convert_document"),{method:"POST",body:o})}catch(e){return(0,v.Tb)(e),a("One or more file uploads have failed. Please try again.")}if(429===r.status)return a("Too many file upload attempts. Please wait and try again later.");if(413===r.status)return a("Uploaded file is too large. Try uploading a smaller part of the document, or copy/pasting an excerpt from the file.");if(!r.ok)return a("Text extraction failed for one of the uploaded files. Please try again.");let i=await r.json();return i&&0!==Object.keys(i).length&&i.extracted_content?(i.file_name=P(t),i):a("Text extraction failed for one of the uploaded files. Please try again.")},R=e=>{var t;let{imagesEnabled:n,blobFileUploadsEnabled:a,rasterizePdfUploadsEnabled:r,onUploadComplete:c,onError:d,projectUuid:f}=e,{activeOrganization:p}=(0,l.t)(),g=null!==(t=null==p?void 0:p.uuid)&&void 0!==t?t:"",[_,v]=(0,y.useState)(!1),{addError:S}=(0,s.e)(),x=(0,y.useCallback)(e=>{v(!1),S(e),d&&d()},[S,d,v]),k=U(),T=Q(),E=N(x),P=(0,i.OJ)(),j=(0,u.K)(),{account:O}=(0,l.t)(),{mutate:D}=(0,o.Ck)(),I=(0,w.default)("multimodal_pdf_a_b").config.getValue("default_on",!1),z=(0,y.useCallback)(async(e,t)=>{b.Statsig.manuallyLogExperimentExposure("multimodal_pdf_a_b",!1),(null==O?void 0:O.settings.enabled_mm_pdfs)===null&&I&&D({...O.settings,enabled_mm_pdfs:!0});let{attachmentUploads:o,imageUploads:i,rasterizedDocumentUploads:l,unsupportedUploads:s,tooLargeUploads:u,outOfContextFileUploads:d}=(0,C.Jw)(e,{imagesEnabled:n,blobFileUploadsEnabled:a,rasterizePdfUploadsEnabled:r}),p=s.map(e=>(0,C.mD)(e.name));if(p.length>0)return x("Files of the following ".concat((0,h._6)(p.length,"format")," are not supported: ").concat([...new Set(p)].join(", "),"."));if(u.length>0)return j.track("file_upload_too_large",{large_files:u.map(e=>({file_type:e.type,file_size:e.size}))}),x("You may not upload files larger than 30mb.");v(!0);let _=[],y=0,w=(e,n)=>{if(void 0===t)return!0;let a=new Blob([n]).size/m.r6;return!((y+=a)>t)||(x("Failed to upload file ".concat(e,". Project knowledge exceeds maximum. Remove files to continue.")),!1)};for(let e of o){let t=await F(P,e,g,x);if(!(t&&w(e.name,t.extracted_content)))return;await c([t],[])}for(let e of i){let t=await k(e),n=await T(t,g);n&&_.push(n)}for(let e of l){let{file:t,attachment:n}=await E(e,g);if(t&&_.push(t),n){if(!w(e.name,n.extracted_content))return;await c([n],[])}}for(let e of d){let t=await T(e,g,f);t&&_.push(t)}await c([],_),v(!1)},[a,P,c,n,x,T,E,g,k,j,r,f,null==O?void 0:O.settings,D,I]);return{isUploading:_,setIsUploading:v,handleError:x,handleUpload:z}},L=d.Z.label(T()),F=async(e,t,n,a)=>{if(!(0,C.dF)(t))try{let e=await (0,C.CL)(t);return D(t,e)}catch(e){}let r=await M(e,t,n,a);if(r)return O(r),r},H=()=>{let{addError:e}=(0,s.e)();return(0,y.useCallback)((t,n)=>{if(t instanceof f.Hx){if("rate_limit_error"===t.type){e((0,r.jsxs)("p",{children:["You've reached your limit for ",n," uploads. Please try again later.",(0,r.jsx)(k.Z,{})]}));return}if("document_password_protected"===t.errorCode){e((0,r.jsx)("p",{children:"The document you uploaded is password protected. Please remove the password and try again."}));return}}e((0,r.jsxs)("p",{children:["Your ",n," upload failed. Please try again."]}))},[e])},Z=()=>{var e,t;let{account:n}=(0,l.t)(),a=(0,w.default)("multimodal_pdf_a_b").config.getValue("default_on",!1);return(null==n?void 0:null===(e=n.settings)||void 0===e?void 0:e.enabled_mm_pdfs)===null&&a?!!a:!!(null==n?void 0:null===(t=n.settings)||void 0===t?void 0:t.enabled_mm_pdfs)}},34016:function(e,t,n){n.d(t,{Z:function(){return s}});var a=n(27573),r=n(51571),o=n(88075),i=n(87659);let l=()=>{let e=(0,r.Z)(),{websiteBaseUrl:t}=(0,r.m)();return e?(0,a.jsxs)(a.Fragment,{children:[" ","Or consider"," ",(0,a.jsx)("a",{href:"/settings/billing?action=subscribe",className:"font-bold underline",rel:"noreferrer",children:"upgrading to Claude Pro"}),"."]}):(0,a.jsxs)(a.Fragment,{children:[" ","Or"," ",(0,a.jsx)(i.default,{href:"".concat(t,"/contact-sales"),className:"font-bold underline",children:"contact sales"})," ","if you would be interested in upgrading to a paid version of Claude."]})};function s(){let e=(0,o.w7)(),t=(0,o.uh)();return e&&!t?(0,a.jsx)(l,{}):null}},27920:function(e,t,n){n.d(t,{hH:function(){return A},wN:function(){return F},Qk:function(){return W},pV:function(){return M},lE:function(){return R}});var a,r,o,i,l=n(27573),s=n(34016),u=n(51571),c=n(88075),d=n(24658),f=n(92973),m=n(65490),p=n(71854),h=n(6734),g=n(36222),_=n(49793),v=n(71994),y=n(13623),b=n(83056),w=n(90930),C=n(82177),S=n(67754),x=n(7653),k=n(48644),T=n(91014);class E{_getBlockCharCount(e){if("text"===e.type)return e.text.length;if("tool_use"===e.type){var t;return(null===(t=e.partial_json)||void 0===t?void 0:t.length)||0}return e.type,0}_maybeConvertMessageEventToContentBlock(e){switch(e.type){case"content_block_delta":if("text_delta"===e.delta.type)return{type:"text",text:e.delta.text};if("input_json_delta"===e.delta.type){let t=this.completionsToSmooth[this.completionsToSmooth.length-1];if(t&&"tool_use"===t.type)return{type:"tool_use",id:"",name:"",partial_json:e.delta.partial_json};if(t&&"tool_result"===t.type)return{type:"tool_result",tool_use_id:"",name:"",is_error:!1,content:[{type:"text",text:e.delta.partial_json}]}}break;case"content_block_start":return e.content_block}}_set_raw_completion(e){0===this.start&&(this.start=Date.now());let t=this._maybeConvertMessageEventToContentBlock(e);t&&(e=>{if(0===this.completionsToSmooth.length){this.completionsToSmooth.push(e);return}let t=this.completionsToSmooth[this.completionsToSmooth.length-1];if(t.type!==e.type||"tool_use"===e.type&&e.id||"tool_result"===e.type&&e.tool_use_id){this.completionsToSmooth.push(e);return}switch(e.type){case"text":"text"===t.type&&(t.text+=e.text);break;case"tool_use":if("tool_use"===t.type){var n,a;t.partial_json=(null!==(n=t.partial_json)&&void 0!==n?n:"")+(null!==(a=e.partial_json)&&void 0!==a?a:"")}break;case"tool_result":"tool_result"===t.type&&(t.content=e.content)}})(t),this.model_done="message_stop"===e.type;let n=this.completionsToSmooth.reduce((e,t)=>e+this._getBlockCharCount(t),0);this.totalCompletionLength=n,this.arrivals.push([(Date.now()-this.start)/1e3,n])}_get_smoothed_completion(){if(0===this.start)return[];let e=(Date.now()-this.start)/1e3,t=this.arrivals[this.arrivals.length-1][1]+(this.model_done?100:0),n=.9*e-.3,a=this.arrivals.filter(e=>e[0]<n).map(e=>e[1]),r=a[a.length-1],o=function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.01;if(t===n)return t;let r=e(t),o=e(n);if(t>=n)throw Error("Lower x is greater than upper x");if(r>a)throw Error("Lower f is greater than zero");if(o<-a)throw Error("Upper f is less than zero");for(;r<-a;){let a=(t+n)/2,i=e(a);i<=0?(t=a,r=i):(n=a,o=i)}return t}(n=>{let a=(n-this.x)/(e-this.t),o=1/(e-this.t);return 2*this.gamma*o*(a-this.v)-1/(n-r)+1/(t-n)},r,t),i=(o-this.x)/(e-this.t);this.v=this.alpha*this.v+(1-this.alpha)*i,this.x=Math.max(o,this.x),this.t=e,this.smoother_done=this.model_done&&this.x>=this.totalCompletionLength,this.stats.push({t:e,x:o,v:i,min_chars:r,max_chars:t});let l=(e,t)=>{if("tool_result"===e.type)return e;if("text"===e.type)return{...e,text:e.text.slice(0,t)};if("tool_use"===e.type){var n;return{...e,partial_json:null===(n=e.partial_json)||void 0===n?void 0:n.slice(0,t)}}return e},s=0,u=[];for(let e of this.completionsToSmooth){let t=this._getBlockCharCount(e);if(s+t<this.x)u.push(e),s+=t;else{let t=l(e,this.x-s);u.push(t);break}}return u}getTextCompletion(){let e=this.completionsToSmooth.find(e=>"text"===e.type);return e&&e.text||""}onMessage(e){this._set_raw_completion(e)}async task(e,t){for(;!this.smoother_done&&!t.aborted;)e(this._get_smoothed_completion()),await new Promise(e=>setTimeout(e,10))}constructor(){this.alpha=.99,this.gamma=1e-5,this.v=100,this.x=0,this.t=0,this.arrivals=[[-9999,0]],this.start=0,this.completionsToSmooth=[],this.totalCompletionLength=0,this.model_done=!1,this.smoother_done=!1,this.stats=[]}}var P=n(80523);(a=o||(o={}))[a.APPEND_MESSAGE_WITH_COMPLETION=1]="APPEND_MESSAGE_WITH_COMPLETION",a[a.RETRY_MESSAGE_WITH_COMPLETION=2]="RETRY_MESSAGE_WITH_COMPLETION",(r=i||(i={})).Ping="ping",r.Completion="completion",r.Error="error",r.ContentBlockDelta="content_block_delta",r.ContentBlockStart="content_block_start",r.ContentBlockStop="content_block_stop",r.MessageDelta="message_delta",r.MessageStart="message_start",r.MessageStop="message_stop",r.MessageLimit="message_limit";let j=["close_file","create_file","delete_file","draw_svg","file_search","open_file","repl","str_replace","update_file"];async function O(e){let{frontendPrivateApiUrl:t,endpoint:n,orgUuid:a,conversationUuid:r,body:o,onCompletion:i,onInvokeTool:l,abortController:s,completion:u,getTools:c}=e,d=new E,f=d.task(i,s.signal),p=null,h=null,g=JSON.stringify({...u,...o,text:void 0,rendering_mode:"messages",organization_uuid:void 0,conversation_uuid:void 0}),_="",v="",b="",w=0,C=(0,P.L)(function(e,t,n,a){let r;if(void 0===n||void 0===a)throw Error("Missing org uuid or conversation uuid");switch(t){case 1:r="completion";break;case 2:r="retry_completion";break;default:throw Error("Invalid endpoint")}return"".concat(e,"/api/organizations/").concat(n,"/chat_conversations/").concat(a,"/").concat(r)}(t,n,a,r),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Accept:"text/event-stream"},body:g,openWhenHidden:!0,signal:s.signal,async onopen(e){var t;if(!e.ok||!(null===(t=e.headers.get("content-type"))||void 0===t?void 0:t.includes(P.a))){let t=await e.text(),n={};try{n=JSON.parse(t)}catch(e){}throw(0,m.fT)(e.status,n,"Failed to fetch",e.headers)}},onmessage(e){var t,n;switch(e.event){case"ping":default:return;case"error":throw(0,m.fT)(0,JSON.parse(e.data),"Streaming error: 22");case"completion":{let n=JSON.parse(e.data);if(void 0===n.completion)throw Error("Unexpected message received when streaming: ".concat(e.data));let a={type:"content_block_delta",index:0,delta:{type:"text_delta",text:n.completion}};p=n.stop_reason,h=null!==(t=n.messageLimit)&&void 0!==t?t:null,d.onMessage(a);break}case"content_block_start":{let t=JSON.parse(e.data);w=t.index,"tool_use"===t.content_block.type&&(v=t.content_block.name,b=t.content_block.id),d.onMessage(t);break}case"content_block_delta":{let t=JSON.parse(e.data);if(t.index!==w)throw Error("Content block index did not match the expected index");(null===(n=t.delta)||void 0===n?void 0:n.type)==="input_json_delta"&&(j.includes(v)||c().some(e=>e.name===v))&&(_+=t.delta.partial_json),d.onMessage(t);break}case"content_block_stop":{if(!v)break;let t=JSON.parse(e.data);if(t.index!==w)throw Error("Content block index did not match the expected index");d.onMessage(t),l(r,v,b,_),_="",v="",b="";break}case"message_delta":case"message_start":case"message_stop":case"message_limit":{let t=JSON.parse(e.data);"message_stop"===t.type&&(p="message_stop"),"message_limit"===t.type&&(h=t.message_limit),d.onMessage(t)}}},onclose(){d.model_done=!0},onerror(e){throw e instanceof m.Hx&&529===e.statusCode||(0,y.Tb)(e),d.model_done=!0,d.smoother_done=!0,e}});return await Promise.all([C,f]),{stopReason:p,messageLimitResult:h}}var D=n(52212),I=n(3982),z=n(46777),U=n(33267),Q=n(44768);let N=(0,x.createContext)([null,null]);function A(e){let{children:t}=e,n=(0,x.useState)({});return(0,l.jsx)(N.Provider,{value:n,children:t})}function M(e,t,n){let{onIncrementalCompletion:a,onStartAppend:r,onStreamCompleted:i}=(0,Q.p)(),l=V({conversationUUID:e,endpoint:o.APPEND_MESSAGE_WITH_COMPLETION,onIncrementalCompletion:a,onStreamCompleted:i,onInvokeTool:t,getTools:n}),{runStream:s}=l,u=(0,x.useCallback)(async t=>{let{prompt:n,attachments:a,files:o,syncSources:i,rethrowErrors:l=!1,modelOverride:u,parent_message_uuid:c,personalized_style:d}=t;await r(e,e=>{if(!e)throw Error("Conversation tree must be provided for tree append");let t=(0,D.HX)(e),r=[{uuid:D.wZ,content:[{type:"text",text:n}],created_at:new Date().toISOString(),sender:"human",attachments:a,files:o,files_v2:o,sync_sources:i,index:t+1,parent_message_uuid:null!=c?c:D.QC},{uuid:D.FC,content:[],created_at:new Date().toISOString(),sender:"assistant",attachments:[],files:[],files_v2:[],sync_sources:[],index:t+2,parent_message_uuid:D.wZ}];return(0,D.vv)(e,r)}),await s({prompt:n,attachments:a,files:o,syncSources:i,rethrowErrors:l,modelOverride:u,parent_message_uuid:c,personalized_style:d})},[s,r,e]);return{...l,runStream:u}}function R(e,t,n,a){let{onIncrementalCompletion:r,onStreamCompleted:i,onStartAppend:l}=(0,Q.p)(),s=V({conversationUUID:e,endpoint:o.RETRY_MESSAGE_WITH_COMPLETION,onIncrementalCompletion:r,onInvokeTool:t,onStreamCompleted:i,getTools:n}),{runStream:u}=s,c=(0,x.useCallback)(async t=>{await l(e,e=>{let n=[{uuid:D.FC,content:[],created_at:new Date().toISOString(),sender:"assistant",attachments:[],files:[],files_v2:[],sync_sources:[],parent_message_uuid:t,selectedOption:0,index:(0,D.HX)(e)+1}];return(0,D.vv)(e,n)}),await u({prompt:"",attachments:[],files:[],syncSources:[],parent_message_uuid:t,personalized_style:a})},[e,u,l,a]);return{...s,runStream:c}}let L="incomplete_stream",F=e=>{var t;let n=H(e),{layer:a}=(0,k.useLayer)("frontend"),r=null===(t=a.get("console_default_model_override",null))||void 0===t?void 0:t.model,{config:o}=(0,k.useConfig)("console_default_model"),i=o.get("model",null);return n||r||i||"claude-2.1"},H=e=>{let{data:t}=(0,T.Rq)(e||""),n=(0,S.useSearchParams)(),a=null==n?void 0:n.get("model");return(null==t?void 0:t.model)?null==t?void 0:t.model:a||void 0},Z={value:null},W=()=>{let e=(0,b.useQueryClient)();return{failedStreamRetryData:(0,w.useQuery)([_.sf],()=>Z.value,{initialData:null}).data||null,setFailedStreamRetryData:(0,x.useCallback)(t=>{Z.value=t,e.invalidateQueries([_.sf])},[e])}};function V(e){var t;let{conversationUUID:n,endpoint:a,getTools:r,onIncrementalCompletion:o,onInvokeTool:i,onStreamCompleted:_}=e,{frontendPrivateApiUrl:b}=(0,u.m)(),{activeOrganization:w}=(0,c.t)(),k=null==w?void 0:w.uuid,{context:E,clearContext:P,setContext:j}=function(e){let[t,n]=(0,x.useContext)(N),[a,r]=(0,x.useState)(),o=(0,x.useCallback)(()=>{n?n(t=>{let n={...t};return delete n[e],n}):r(void 0)},[e,n]),i=(0,x.useCallback)(t=>{n?n(n=>({...n,[e]:t})):r(t)},[e,n]);return{context:t?t[e]:a,clearContext:o,setContext:i}}(n),D=(0,S.useSearchParams)(),Q=null==D?void 0:D.get("t"),A=null!==(t=H(n))&&void 0!==t?t:"",M=null==D?void 0:D.get("max_tokens"),R=(0,U.n)(),{addError:F,clearToast:Z}=(0,d.e)(),V=(0,x.useMemo)(v.H,[]),Y=(0,T.$H)("push",V),{setFailedStreamRetryData:B}=W(),J=(0,x.useCallback)(async e=>{await (null==_?void 0:_(n,e)),P()},[_,n,P]),K=(0,x.useCallback)((e,t,a)=>{if(e===L)return F("Network connection interrupted. Claude may still be responding, please wait for a bit to see the response.");if(!(e instanceof m.Hx))return F("We couldn’t connect to Claude. Please check your network connection and try again.");if("rate_limit_error"===e.type){if(e.message.includes("{")&&k)try{let t=JSON.parse(e.message);R(t,k,n)}catch(e){}return F((0,l.jsxs)("p",{children:["You've reached the limit for Claude messages at this time. Please wait before trying again. ",(0,l.jsx)(s.Z,{})]}))}if("not_found_error"===e.type)return F((0,l.jsx)("p",{children:"Claude model version not found."}));if("billing_error"===e.type)return F((0,l.jsxs)("p",{children:["We had an unexpected billing error, please"," ",(0,l.jsx)("a",{className:"underline",href:"https://support.anthropic.com/en/articles/9015913-how-can-i-contact-support",target:"_blank",rel:"noreferrer",children:"contact support."})," "]}));if("overloaded_error"===e.type)return F((0,l.jsxs)("p",{children:["Due to unexpected capacity constraints, Claude is unable to respond to your message. Please try again soon.",(0,l.jsx)(s.Z,{})]}));if("exceeded_max_uploads_per_message"===e.errorCode){F("Your message will exceed the maximum number of files allowed per message. Consider removing some of your file or adding files over several messages.");return}if("exceeded_max_image_limit_per_chat"===e.errorCode){let e=F((0,l.jsxs)("p",{children:["Your message will exceed the"," ",(0,l.jsx)("a",{className:"underline",target:"_blank",rel:"noreferrer",href:p._R,children:"maximum image count"})," ","for this chat.",a>0?(0,l.jsxs)(l.Fragment,{children:[" ","Try uploading ",(0,g._6)(a,"document")," ","with fewer pages, removing images,"]}):" Try removing images"," ",(0,l.jsx)("a",{href:"#",className:"underline",onClick:t=>{t.preventDefault(),Y(),Z(e)},children:"or starting a new conversation."}),(0,l.jsx)(s.Z,{})]}));return}if("invalid_request_error"===e.type&&413===e.statusCode){let e=F((0,l.jsxs)("p",{children:["Your message will exceed the"," ",(0,l.jsx)("a",{className:"underline",target:"_blank",rel:"noreferrer",href:p.jC,children:"length limit"})," ","for this chat.",t>0?" Try attaching fewer or smaller files":" Try shortening your message"," ",(0,l.jsx)("a",{href:"#",className:"underline",onClick:t=>{t.preventDefault(),Y(),Z(e)},children:"or starting a new conversation."}),(0,l.jsx)(s.Z,{})]}));return}return"invalid_request_error"===e.type&&"read_only_mode"===e.extra.code?F((0,l.jsx)("p",{children:"Due to capacity constraints, chatting with Claude is currently not available. Please try again in a little while."})):F(e)},[F,k,R,n,Y,Z]),G=(0,f.K)(),q=function(){let{height:e,width:t}=(0,I.iP)(),n=[];return n.length?n.join("\n"):null}(),X=(0,x.useCallback)(async e=>{let{prompt:t,attachments:l,files:s,syncSources:u,rethrowErrors:c=!1,modelOverride:d,parent_message_uuid:f,personalized_style:m}=e;if(E)return;if(!w)throw Error("Cannot stream without an organization");let p=new AbortController;j({controller:p}),B(null);let g={prompt:t,parent_message_uuid:f,timezone:C.ou.local().zoneName||void 0,personalized_styles:m?[m]:void 0},_=(0,z.l)();(_||q)&&(g.custom_system_prompt=[_,q].filter(Boolean).join("\n")),A&&"string"==typeof A&&(g.model=A),d&&(g.model=d),"string"==typeof Q&&(g.temperature=parseInt(Q)),M&&"string"==typeof M&&(g.max_tokens_to_sample=parseInt(M));let v=r();v.length&&(g.tools=v);let S=[],x=null,k=null,T=null;try{x=(T=await O({frontendPrivateApiUrl:b,endpoint:a,orgUuid:w.uuid,conversationUuid:n,body:{organization_uuid:w.uuid,conversation_uuid:n,text:t,attachments:l,files:s.map(e=>e.file_uuid),sync_sources:u.map(e=>e.uuid)},onCompletion:e=>{o(n,e),S=e},onInvokeTool:i,abortController:p,completion:g,getTools:r})).stopReason,k=T.messageLimitResult}catch(e){if(B({prompt:t,attachments:l,files:s}),K(e,l.length+s.length,s.filter(e=>"document"===e.file_kind).length),(0,y.Tb)(e),c||(0,h.yG)())throw e}finally{T&&!x&&(o(n,S),K(L,l.length+s.length,s.filter(e=>"document"===e.file_kind).length),G.track("sse_interrupted"),(0,y.uT)("sse_interrupted"),await new Promise(e=>setTimeout(e,3e4))),await J(k)}return S},[E,w,j,B,q,A,Q,M,r,b,a,n,i,o,K,J,G]),$=(0,x.useCallback)(()=>{E&&(E.controller.abort(),J(null))},[E,J]);return{runStream:X,isStreaming:!!E,abortStream:$}}},46777:function(e,t,n){n.d(t,{h:function(){return o},l:function(){return i}});var a=n(7653);let r="customSystemPrompt",o=()=>{let[e,t]=(0,a.useState)(()=>"undefined"==typeof localStorage?"":localStorage.getItem(r)||"");return(0,a.useEffect)(()=>{localStorage.setItem(r,e)},[e]),{customSystemPrompt:e,setCustomSystemPrompt:t}},i=()=>"undefined"==typeof localStorage?"":localStorage.getItem(r)},23489:function(e,t,n){n.d(t,{V:function(){return s},u:function(){return u}});var a=n(89992),r=n(88075),o=n(49793),i=n(48644);let l={image_in:!1,pdf_in:!1},s=e=>{let{activeOrganization:t}=(0,r.t)(),n=null==t?void 0:t.uuid,{data:i,isLoading:s,isPreviousData:u}=(0,a.WE)("/api/organizations/".concat(n,"/model_configs/").concat(e),{queryKey:[o.Qn,n,e],enabled:!!n,staleTime:3e5,meta:{noToast:!0}});return{isLoading:s,modelConfig:!u&&i||l}},u=()=>{let{config:e}=(0,i.useConfig)("claude_ai_models"),t=e.get("models",[]),n=t.filter(e=>!e.inactive),a=n.filter(e=>!e.overflow),r=n.filter(e=>e.overflow);return{allModelOptions:t,activeModelOptions:n,mainModels:a,overflowModels:r}}},65930:function(e,t,n){n.d(t,{b:function(){return f},w:function(){return m}});var a=n(88075),r=n(49793),o=n(71994),i=n(83056),l=n(84739),s=n.n(l),u=n(67754),c=n(7653),d=n(91014);let f=()=>{let e="new-conversation-params-for-navigation",t=(0,i.useQueryClient)(),n=(0,c.useCallback)(()=>{let t=localStorage.getItem(e);if(!t)return{};try{let e=JSON.parse(t);return s()(e,e=>Date.now()-e.created_at<6e4)}catch(t){localStorage.removeItem(e)}return{}},[]);return{prepareNewConversation:(0,c.useCallback)((a,r)=>{let o={created_at:Date.now(),...r};t.setQueryData([e,a],o);let i=n();i[a]=o;try{localStorage.setItem(e,JSON.stringify(i))}catch(e){}},[t,n]),getCreateParamsForConvo:(0,c.useCallback)(a=>{let r=n(),o=t.getQueryData([e,a])||r[a];t.removeQueries([e,a]);let i=s()(r,(e,t)=>t!==a);return localStorage.setItem(e,JSON.stringify(i)),o},[t,n])}},m=()=>{let{mutateAsync:e}=(0,d.$Y)(),[t,n]=(0,c.useReducer)(o.H,"",o.H),{prepareNewConversation:l}=f(),s=(0,i.useQueryClient)(),{activeOrganization:m}=(0,a.t)(),p=null==m?void 0:m.uuid,h=(0,u.useRouter)();return(0,c.useCallback)(async a=>{let{model:o,project_uuid:i}=a,u=e({uuid:t,name:"",model:o,project_uuid:i});l(t,a),await u,h.push("/chat/".concat(t)),n(),s.invalidateQueries([r.tv,{orgUUID:p}])},[e,t,h,l,s,p])}},64969:function(e,t,n){n.d(t,{M:function(){return s}});var a=n(44846),r=n(90930),o=n(7653),i=n(27920),l=n(23489);let s=()=>{let e="sticky-model-selector",{value:t}=(0,a.F)("sticky_model_selector"),{value:n}=(0,a.F)("model_selector_enabled"),{activeModelOptions:s}=(0,l.u)(),u=(0,i.wN)(null),c=(0,r.useQuery)([e],()=>{if(!t||!n)return null;let a=localStorage.getItem(e);return a===u?null:a&&s.find(e=>e.model===a)?a:null},{initialData:null}),d=(0,o.useCallback)(t=>{t&&localStorage.setItem(e,t),c.refetch()},[c]);return{stickyModelPreference:c.data,setStickyModelPreference:d}}},33267:function(e,t,n){n.d(t,{I:function(){return u},n:function(){return s}});var a=n(89992),r=n(88075),o=n(49793),i=n(83056),l=n(7653);let s=()=>{let e=(0,i.useQueryClient)();return(0,l.useCallback)((t,n,a)=>{"within_limit"!==t.type&&(t.conversationUUID=a),e.setQueryData([o.aY],e=>e?{...e,messageLimits:{...e.messageLimits,[n]:t}}:e)},[e])},u=e=>{let{activeOrganization:t}=(0,r.t)(),n=null==t?void 0:t.uuid,o=s(),i={type:"within_limit"};return(0,a.uC)(()=>"/api/organizations/".concat(n,"/reset_rate_limits"),"POST",{onSuccess:()=>{o(i,n,e||"")},meta:{noToast:!0}})}},44768:function(e,t,n){n.d(t,{p:function(){return u}});var a=n(88075),r=n(49793),o=n(83056),i=n(7653),l=n(52212),s=n(33267);let u=()=>{let e=(0,o.useQueryClient)(),{activeOrganization:t}=(0,a.t)(),n=null==t?void 0:t.uuid,u=(0,i.useRef)(),c=(0,s.n)(),d=(0,i.useCallback)(async(t,a)=>{let o=[r.I8,{orgUUID:n},{uuid:t}],i=e.getQueryData(o);if(!i)throw Error("Conversation tree must be provided for append");let l=a(i);u.current=l,await e.cancelQueries(o),e.setQueryData(o,u.current)},[e,n]),f=(0,i.useCallback)((t,a)=>{0!==a.length&&e.setQueryData([r.I8,{orgUUID:n},{uuid:t}],()=>{let e=u.current;if(!e)throw Error("Conversation tree must be provided for incremental completion");if(!e.current_leaf_message_uuid)throw Error("Couldn't figure out where to put completion");let t=e.messageByUuid.get(e.current_leaf_message_uuid);if(!t)throw Error("New assistant message not found");return t.content=a,{...e,created_at:new Date().toISOString()}})},[e,n]);return{onStartAppend:d,onStreamCompleted:(0,i.useCallback)(async(t,a)=>{let o=[r.I8,{orgUUID:n},{uuid:t}];u.current=void 0,a?(e.setQueryData([r.tv,{orgUUID:n}],e=>{if(!e)return;let n=e.find(e=>e.uuid===t);return n?[{...n,updated_at:new Date().toISOString()},...e.filter(e=>e.uuid!==t)]:e}),await e.invalidateQueries(o)):e.invalidateQueries(o),a&&n&&c(a,n,t)},[e,c,n]),onIncrementalCompletion:f,changeDisplayedConversationPath:(0,i.useCallback)((t,a,o,i)=>{e.setQueryData([r.I8,{orgUUID:n},{uuid:t}],e=>{if(!e)throw Error("Conversation tree must be provided for changeDisplayedConversationPath");let t=(0,l.mj)(e,a,o);return t.current_leaf_message_uuid&&i&&i(t.current_leaf_message_uuid),t})},[e,n])}}},6734:function(e,t,n){n.d(t,{cm:function(){return r},yG:function(){return a}}),n(68571);let a=()=>!1,r=()=>!1},17741:function(e,t,n){n.d(t,{KS:function(){return o},vV:function(){return r}});let a=/^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}$/,r=e=>a.test(e),o=(e,t)=>{if(!t)return!1;let n=e.split("@")[1];return t.includes(n)}},36222:function(e,t,n){n.d(t,{M0:function(){return r},_6:function(){return a},zd:function(){return o}});let a=(e,t,n)=>1===e?t:n||t+"s",r=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"s",r=a(e,t,t+n);return"".concat(e," ").concat(r)};function o(e,t){switch(e.length){case 0:return"";case 1:return e[0];case 2:return e.join(" ".concat(t," "));default:return[...e.slice(0,-1),"".concat(t," ").concat(e.at(-1))].join(", ")}}}}]);